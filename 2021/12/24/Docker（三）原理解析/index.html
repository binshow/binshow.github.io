<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Docker（三）原理解析 - 漫漫转码路</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="漫漫转码路"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="漫漫转码路"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Docker中镜像的原理"><meta property="og:type" content="blog"><meta property="og:title" content="Docker（三）原理解析"><meta property="og:url" content="http://example.com/2021/12/24/Docker%EF%BC%88%E4%B8%89%EF%BC%89%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"><meta property="og:site_name" content="漫漫转码路"><meta property="og:description" content="Docker中镜像的原理"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://raw.githubusercontent.com/binshow/img/master/20211224203014.png"><meta property="og:image" content="https://raw.githubusercontent.com/binshow/img/master/20211224203747.png"><meta property="og:image" content="https://raw.githubusercontent.com/binshow/img/master/image-20211224204424947.png"><meta property="og:image" content="https://raw.githubusercontent.com/binshow/img/master/20211224204719.png"><meta property="og:image" content="https://raw.githubusercontent.com/binshow/img/master/20211224212954.png"><meta property="og:image" content="https://raw.githubusercontent.com/binshow/img/master/20211226150506.png"><meta property="article:published_time" content="2021-12-24T12:21:43.000Z"><meta property="article:modified_time" content="2021-12-26T07:13:12.725Z"><meta property="article:author" content="binshow"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://raw.githubusercontent.com/binshow/img/master/20211224203014.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2021/12/24/Docker%EF%BC%88%E4%B8%89%EF%BC%89%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"},"headline":"Docker（三）原理解析","image":["https://raw.githubusercontent.com/binshow/img/master/20211224203014.png","https://raw.githubusercontent.com/binshow/img/master/20211224203747.png","https://raw.githubusercontent.com/binshow/img/master/image-20211224204424947.png","https://raw.githubusercontent.com/binshow/img/master/20211224204719.png","https://raw.githubusercontent.com/binshow/img/master/20211224212954.png","https://raw.githubusercontent.com/binshow/img/master/20211226150506.png"],"datePublished":"2021-12-24T12:21:43.000Z","dateModified":"2021-12-26T07:13:12.725Z","author":{"@type":"Person","name":"binshow"},"description":"Docker中镜像的原理"}</script><link rel="canonical" href="http://example.com/2021/12/24/Docker%EF%BC%88%E4%B8%89%EF%BC%89%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="漫漫转码路" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-24T12:21:43.000Z" title="2021/12/24 下午8:21:43">2021-12-24</time>发表</span><span class="level-item"><time dateTime="2021-12-26T07:13:12.725Z" title="2021/12/26 下午3:13:12">2021-12-26</time>更新</span><span class="level-item">34 分钟读完 (大约5041个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Docker（三）原理解析</h1><div class="content"><p>Docker中镜像的原理</p>
<span id="more"></span>



<h1 id="镜像原理"><a href="#镜像原理" class="headerlink" title="镜像原理"></a>镜像原理</h1><h2 id="镜像是什么"><a href="#镜像是什么" class="headerlink" title="镜像是什么"></a>镜像是什么</h2><p>镜像是一种<strong>轻量级、可执行</strong>的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含<strong>某个软件所需要的所有内容，包括代码、运行时库、环境变量和配置文件。</strong></p>
<h2 id="联合文件系统UnionFs"><a href="#联合文件系统UnionFs" class="headerlink" title="联合文件系统UnionFs"></a>联合文件系统UnionFs</h2><p>Union文件系统（UnionFS）是一种<strong>分层、轻量级并且高性能</strong>的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。</p>
<p>Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。 <strong>特性</strong>：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p>
<p>下载docker镜像时一层一层的其实就是联合文件系统的体现：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [20:27:52] C:1</span></span><br><span class="line">$ docker pull redis:6.0</span><br><span class="line">6.0: Pulling from library/redis</span><br><span class="line">927a35006d93: Already exists		// 下面这一层一层的就是分层的文件系统</span><br><span class="line">6a72fe8b7ea0: Pull complete</span><br><span class="line">cf790b96aa00: Pull complete</span><br><span class="line">fb7d0a855938: Pull complete</span><br><span class="line">970fe850a4f2: Pull complete</span><br><span class="line">1af407e7eaff: Pull complete</span><br><span class="line">Digest: sha256:20756751c3382cf4867bef796eeda760e93022ec3decdd9803dea7a4f33f3b4b</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> redis:6.0</span><br><span class="line">docker.io/library/redis:6.0</span><br></pre></td></tr></table></figure>



<h2 id="镜像加载原理"><a href="#镜像加载原理" class="headerlink" title="镜像加载原理"></a>镜像加载原理</h2><p>docker的镜像<strong>实际上由一层一层的文件系统组成</strong>，这种层级的文件系统UnionFS。最底层的有：</p>
<ul>
<li> **bootfs(boot file system)**主要包含bootloader和kernel, bootloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</li>
<li><strong>rootfs (root file system)</strong> ，在bootfs之上。包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/binshow/img/master/20211224203014.png" alt="20211224203014"></p>
<p>对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，<strong>因为底层直接用Host的kernel，自己只需要提供 rootfs 就行了</strong>。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别, 因此不同的发行版可以公用bootfs。</p>
<h2 id="分层的好处"><a href="#分层的好处" class="headerlink" title="分层的好处"></a>分层的好处</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [20:27:52] C:1</span></span><br><span class="line">$ docker pull redis:6.0</span><br><span class="line">6.0: Pulling from library/redis</span><br><span class="line">927a35006d93: Already exists		// 已经存在了，就不需要下载了</span><br><span class="line">6a72fe8b7ea0: Pull complete</span><br><span class="line">cf790b96aa00: Pull complete</span><br><span class="line">fb7d0a855938: Pull complete</span><br><span class="line">970fe850a4f2: Pull complete</span><br><span class="line">1af407e7eaff: Pull complete</span><br><span class="line">Digest: sha256:20756751c3382cf4867bef796eeda760e93022ec3decdd9803dea7a4f33f3b4b</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> redis:6.0</span><br><span class="line">docker.io/library/redis:6.0</span><br></pre></td></tr></table></figure>

<p>也可以使用inspect来查看镜像的具体信息：从下面也可以看到 redis:6.0 和nginx的第一层是一样的，都是lc79xxx</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect redis:<span class="number">6.0</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;RootFS&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;Type&quot;</span>: <span class="string">&quot;layers&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Layers&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;sha256:1c79be3b9cebb9838b5c607567cb18eb50cd94e39b20a6241ca7d2d53dcffc89&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:cc78bea198527e5e265b0b31cb556c5d3d7a27515acb01217c2c1c762a0be7f0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:e761f8d2b6143444dd084ea055730aee421372f7e4859b0bb2a8b9b4889913b0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:0533b7e61bd36ae9f50eb59e1978f8d1b652c671d90fb99ead5f218fb1b26efe&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:ba9ba4d1a434822ec0abd2302702314fdd164e9f7fa04633097f68b0db21c353&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:7ca1006cdbe50b9d4e7a178565d6000669a891a1ae73c10fbe1e26a583a75034&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker image inspect nginx:</span><br><span class="line"><span class="string">&quot;RootFS&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;Type&quot;</span>: <span class="string">&quot;layers&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Layers&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;sha256:1c79be3b9cebb9838b5c607567cb18eb50cd94e39b20a6241ca7d2d53dcffc89&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:14094e49edd4a92c3fda06c84f2f1356751572b7c5fa3c9fe3f805874abeede9&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:73aad438cb2851ca163618f92bec4e849a89cf9f67b2b348efff46179cd16e6e&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:8bd5bd3f7acb19ff37217771b6f97fc43c470637d7ebe0d7d4e300b0e222d8f4&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:c1faa131c3402b2f1e3c12996a2fa8bbfb344a18c6a9d157632f1f85a63804ab&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:c92f511a5cc24659fb8b6784dd667e8e2296e1514be70ea1b479d806a9926fc4&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure>



<p><strong>分层的好处</strong>：</p>
<p>最大的一个好处就是 - <code>共享资源</code></p>
<p>比如：有多个镜像都从相同的 base 镜像构建而来，那么 Docker Host 只需在磁盘上保存一份 base 镜像；同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p>
<blockquote>
<p>如果多个容器共享一份基础镜像，当某个容器修改了基础镜像的内容，比如 /etc 下的文件，这时其他容器的 /etc 是否也会被修改？ 答案：不会！因为修改会被限制在单个容器内。</p>
</blockquote>
<p>这就是我们接下来要学习的容器 Copy-on-Write 特性</p>
<blockquote>
<p><strong>不同仓库中，可能也会存在镜像重名的情况发生, 这种情况咋办？</strong></p>
<p>严格意义上，我们在使用 <code>docker pull</code> 命令时，还需要在镜像前面指定仓库地址(<code>Registry</code>), 如果不指定，则 Docker  会使用您默认配置的仓库地址。例如上面，由于我配置的是国内 <code>docker.io</code> 的仓库地址，我在 <code>pull</code> 的时候，docker 会默认为我加上 <code>docker.io/library</code> 的前缀。</p>
<p>如：当我执行 <code>docker pull mysql:5.7</code> 命令时，实际上相当于 <code>docker pull docker.io/mysql:5.7</code>，如果您未自定义配置仓库，则默认在下载的时候，会在镜像前面加上 DockerHub 的地址。</p>
<p>Docker 通过前缀地址的不同，来保证不同仓库中，重名镜像的唯一性。</p>
</blockquote>
<h2 id="容器的可写层"><a href="#容器的可写层" class="headerlink" title="容器的可写层"></a>容器的可写层</h2><p>当容器启动时，一个新的可写层被加载到镜像的顶部。 这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。所有操作都是针对容器层的，只有容器层是可写的，容器层下面的所有镜像层都是只读的。</p>
<p><img src="https://raw.githubusercontent.com/binshow/img/master/20211224203747.png" alt="20211224203747"></p>
<p>已启动Tomcat为例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [20:33:57]</span></span><br><span class="line">$ docker pull tomcat</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/tomcat</span><br><span class="line">94a23d3cb5be: Pull complete</span><br><span class="line">ac9d381bd1e9: Pull complete</span><br><span class="line">aa9c5b49b9db: Pull complete</span><br><span class="line">841dd868500b: Pull complete</span><br><span class="line">42dee876d816: Pull complete</span><br><span class="line">c4851c976ae9: Pull complete</span><br><span class="line">e80a0433b650: Pull complete</span><br><span class="line">e10afb8c99ce: Pull complete</span><br><span class="line">7870523e466f: Pull complete</span><br><span class="line">Digest: sha256:9dee185c3b161cdfede1f5e35e8b56ebc9de88ed3a79526939701f3537a52324</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> tomcat:latest</span><br><span class="line">docker.io/library/tomcat:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [20:43:16] C:130</span></span><br><span class="line">$ docker run -d -p 8082:8080 tomcat</span><br><span class="line">768a457c852d8d4a2f39ec27abcb87a0dcb82b8263bbd8fd01eb05aabf4320d4</span><br></pre></td></tr></table></figure>



<p><img src="https://raw.githubusercontent.com/binshow/img/master/image-20211224204424947.png" alt="image-20211224204424947"></p>
<p>登录进docker容器中，在webapps里面放入一些照片：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [20:44:51]</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it 768a bash</span><br><span class="line">root@768a457c852d:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># ls</span></span><br><span class="line">BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist</span><br><span class="line">CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work</span><br><span class="line">root@768a457c852d:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@768a457c852d:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">root@768a457c852d:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># cd ..</span></span><br><span class="line">root@768a457c852d:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cp -r webapps.dist/* webapps</span></span><br><span class="line">root@768a457c852d:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@768a457c852d:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@768a457c852d:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>再打开就能看到初始化页面了：</p>
<p><img src="https://raw.githubusercontent.com/binshow/img/master/20211224204719.png" alt="20211224204719"></p>
<p>现在我想将自己的tomcat打成一个镜像文件：通过docker commit命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [20:48:43]</span></span><br><span class="line">$ docker commit -a=<span class="string">&quot;binshow&quot;</span> -m <span class="string">&quot;add init file&quot;</span> 768a457c852d tomcat_test:1.0</span><br><span class="line">sha256:66ce593a481e28231a5de69d0a51a97eae505b9c89a9884e524f2c0780dc0d4c</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [20:49:23]</span></span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY               TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat_test              1.0       66ce593a481e   8 seconds ago   673MB</span><br><span class="line">tomcat                   latest    b64abfdee99c   2 days ago      668MB</span><br><span class="line">redis                    6.0       9efb4c52c5bc   3 days ago      106MB</span><br><span class="line">nginx                    latest    fc16ec0c2d91   3 days ago      134MB</span><br><span class="line">docker/getting-started   latest    720f449e5af2   3 weeks ago     27.2MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [20:49:42] C:1</span></span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY               TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">tomcat_test              1.0       66ce593a481e   46 seconds ago   673MB	// 673 &gt; 668 多了一些东西</span><br><span class="line">tomcat                   latest    b64abfdee99c   2 days ago       668MB</span><br><span class="line">redis                    6.0       9efb4c52c5bc   3 days ago       106MB</span><br><span class="line">nginx                    latest    fc16ec0c2d91   3 days ago       134MB</span><br><span class="line">docker/getting-started   latest    720f449e5af2   3 weeks ago      27.2MB</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自己打包的tomcat_test:确实多了一层</span></span><br><span class="line"><span class="string">&quot;RootFS&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;Type&quot;</span>: <span class="string">&quot;layers&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Layers&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;sha256:dd5b48ca5196c48f1a866eec959e88eb41d9aaf47b708e343e1b12802a421264&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:fe09b9981fd21fd1aaa81e504536f550ce9d9f5c415f97cba5434de181481505&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:cba7a92f211b56f4f2f1e7d2549bf3d913abfaecfae5b3b0cf96af17abcb5238&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:ffd50287b468e69a2042645381db5c5650912ca89edb1ed89ee6ac7c4f2636ea&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:ab26891579569c3c7a4b3a1162d7d86888bc9653601a4b6bf897c005d858be2a&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:5c6a9f0087d1dc7b0836caadafa08280e5b1a52c6230847dacdcd51aa21e8e71&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:c465d33491e24e1bdf8bb3434ad5c32f51403074a40e520994e090a524ce0d23&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:0fd4f18b8f5ec03881f5a6b4ecf056ca25277090860cda3cd5e3eff7005b914e&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:46c3a00bd8788cba324ea4ad487862821646799d8de81d1e23631706292ccc16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:0ec70bd0f442de228cce5b1d9cf1c960fc264a008985a938873a009d2c35630f&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始的tomcat：</span></span><br><span class="line"><span class="string">&quot;RootFS&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;Type&quot;</span>: <span class="string">&quot;layers&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Layers&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;sha256:dd5b48ca5196c48f1a866eec959e88eb41d9aaf47b708e343e1b12802a421264&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:fe09b9981fd21fd1aaa81e504536f550ce9d9f5c415f97cba5434de181481505&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:cba7a92f211b56f4f2f1e7d2549bf3d913abfaecfae5b3b0cf96af17abcb5238&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:ffd50287b468e69a2042645381db5c5650912ca89edb1ed89ee6ac7c4f2636ea&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:ab26891579569c3c7a4b3a1162d7d86888bc9653601a4b6bf897c005d858be2a&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:5c6a9f0087d1dc7b0836caadafa08280e5b1a52c6230847dacdcd51aa21e8e71&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:c465d33491e24e1bdf8bb3434ad5c32f51403074a40e520994e090a524ce0d23&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:0fd4f18b8f5ec03881f5a6b4ecf056ca25277090860cda3cd5e3eff7005b914e&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:46c3a00bd8788cba324ea4ad487862821646799d8de81d1e23631706292ccc16&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure>



<h1 id="docker中网络通信原理"><a href="#docker中网络通信原理" class="headerlink" title="docker中网络通信原理"></a>docker中网络通信原理</h1><h2 id="如何实现通信的"><a href="#如何实现通信的" class="headerlink" title="如何实现通信的"></a>如何实现通信的</h2><p>当 Docker 启动时，会自动在主机上创建一个 <code>docker0</code> 虚拟网桥，实际上是 Linux 的一个 bridge，可以理解为一个软件交换机。它会在挂载到它的网口之间进行转发。</p>
<p>同时，Docker 随机分配一个本地未占用的私有网段（在 <a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc1918">RFC1918</a> 中定义）中的一个地址给 <code>docker0</code> 接口。比如典型的 <code>172.17.42.1</code>，掩码为 <code>255.255.0.0</code>。此后启动的容器内的网口也会自动分配一个同一网段（<code>172.17.0.0/16</code>）的地址。</p>
<p>当创建一个 Docker 容器的时候，同时会创建了一对 <code>veth pair</code> 接口（当数据包发送到一个接口时，另外一个接口也可以收到相同的数据包）。这对接口一端在容器内，即 <code>eth0</code>；另一端在本地并被挂载到 <code>docker0</code> 网桥，名称以 <code>veth</code> 开头（例如 <code>vethAQI2QT</code>）。通过这种方式，主机可以跟容器通信，容器之间也可以相互通信。Docker 就创建了在主机和所有容器之间一个虚拟共享网络。</p>
<p><img src="https://raw.githubusercontent.com/binshow/img/master/20211224212954.png" alt="20211224212954"></p>
<p>启动一个tomcat并查看详情：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:33:18]</span></span><br><span class="line">$ docker run -d -p 8081:8080 --name mytomcat tomcat_test:1.0</span><br><span class="line">0c18fe55b147c0a8189b3710806a3171bd0bfff63020f3ddbd054273b92ee8ab</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:33:59]</span></span><br><span class="line">$ docker inspect 0c18fe5</span><br></pre></td></tr></table></figure>



<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;NetworkSettings&quot;</span>: &#123;</span><br><span class="line">           <span class="attr">&quot;Bridge&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;SandboxID&quot;</span>: <span class="string">&quot;db1c881ea13b9b0512a5f46e45bf781591d42b08b991f0dd006bab1258795017&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;HairpinMode&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">           <span class="attr">&quot;LinkLocalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;LinkLocalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">           <span class="attr">&quot;Ports&quot;</span>: &#123;</span><br><span class="line">               <span class="attr">&quot;8080/tcp&quot;</span>: [</span><br><span class="line">                   &#123;</span><br><span class="line">                       <span class="attr">&quot;HostIp&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">                       <span class="attr">&quot;HostPort&quot;</span>: <span class="string">&quot;8081&quot;</span></span><br><span class="line">                   &#125;</span><br><span class="line">               ]</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">&quot;SandboxKey&quot;</span>: <span class="string">&quot;/var/run/docker/netns/db1c881ea13b&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;SecondaryIPAddresses&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">           <span class="attr">&quot;SecondaryIPv6Addresses&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">           <span class="attr">&quot;EndpointID&quot;</span>: <span class="string">&quot;173b4014acbc0e870c7241697587f51fdc716ee6cc2db48b265bc2144020280d&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;GlobalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">           <span class="attr">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;IPPrefixLen&quot;</span>: <span class="number">16</span>,</span><br><span class="line">           <span class="attr">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">               <span class="attr">&quot;bridge&quot;</span>: &#123;		<span class="comment">// 网络端口挂在桥上</span></span><br><span class="line">                   <span class="attr">&quot;IPAMConfig&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                   <span class="attr">&quot;Links&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                   <span class="attr">&quot;Aliases&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                   <span class="attr">&quot;NetworkID&quot;</span>: <span class="string">&quot;ec66f3dbb3793f7390414bc7ac1b99ba93eecf5e0a31d67ff9b218dc32735638&quot;</span>,</span><br><span class="line">                   <span class="attr">&quot;EndpointID&quot;</span>: <span class="string">&quot;173b4014acbc0e870c7241697587f51fdc716ee6cc2db48b265bc2144020280d&quot;</span>,</span><br><span class="line">                   <span class="attr">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">                   <span class="attr">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,  <span class="comment">// 自己的ip地址</span></span><br><span class="line">                   <span class="attr">&quot;IPPrefixLen&quot;</span>: <span class="number">16</span>,</span><br><span class="line">                   <span class="attr">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                   <span class="attr">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                   <span class="attr">&quot;GlobalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                   <span class="attr">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">                   <span class="attr">&quot;DriverOpts&quot;</span>: <span class="literal">null</span></span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>



<p>再启动一个tomcat：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:34:12]</span></span><br><span class="line">$ docker run -d -p 8082:8080 --name mytomcat02 tomcat_test:1.0</span><br><span class="line">7610171c5d1b90d5e1f9666c952f5e6ea42f991a0b4ba73436a2e3ef535ea41b</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:36:35]</span></span><br><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND             CREATED          STATUS          PORTS                    NAMES</span><br><span class="line">7610171c5d1b   tomcat_test:1.0   <span class="string">&quot;catalina.sh run&quot;</span>   11 seconds ago   Up 10 seconds   0.0.0.0:8082-&gt;8080/tcp   mytomcat02</span><br><span class="line">0c18fe55b147   tomcat_test:1.0   <span class="string">&quot;catalina.sh run&quot;</span>   2 minutes ago    Up 2 minutes    0.0.0.0:8081-&gt;8080/tcp   mytomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:36:45]</span></span><br><span class="line">$ docker inspect 7610171c5d1b</span><br></pre></td></tr></table></figure>

<p>网络配置如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;NetworkSettings&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;Bridge&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;SandboxID&quot;</span>: <span class="string">&quot;6346254efe61b5ff80f7ad8d3d19ac5c1a2d928d299a06834fe98a860442498f&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;HairpinMode&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;LinkLocalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;LinkLocalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">&quot;Ports&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;8080/tcp&quot;</span>: [</span><br><span class="line">                  &#123;</span><br><span class="line">                      <span class="attr">&quot;HostIp&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">                      <span class="attr">&quot;HostPort&quot;</span>: <span class="string">&quot;8082&quot;</span></span><br><span class="line">                  &#125;</span><br><span class="line">              ]</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;SandboxKey&quot;</span>: <span class="string">&quot;/var/run/docker/netns/6346254efe61&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;SecondaryIPAddresses&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">          <span class="attr">&quot;SecondaryIPv6Addresses&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">          <span class="attr">&quot;EndpointID&quot;</span>: <span class="string">&quot;45c2b821b57cdf718b606c7873a7f4ef4b75a1818906e53b2f21367a45b2fc76&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;GlobalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.3&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;IPPrefixLen&quot;</span>: <span class="number">16</span>,</span><br><span class="line">          <span class="attr">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:03&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;bridge&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;IPAMConfig&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                  <span class="attr">&quot;Links&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                  <span class="attr">&quot;Aliases&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                  <span class="attr">&quot;NetworkID&quot;</span>: <span class="string">&quot;ec66f3dbb3793f7390414bc7ac1b99ba93eecf5e0a31d67ff9b218dc32735638&quot;</span>,</span><br><span class="line">                  <span class="attr">&quot;EndpointID&quot;</span>: <span class="string">&quot;45c2b821b57cdf718b606c7873a7f4ef4b75a1818906e53b2f21367a45b2fc76&quot;</span>,</span><br><span class="line">                  <span class="attr">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,	<span class="comment">//网关地址</span></span><br><span class="line">                  <span class="attr">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.3&quot;</span>, <span class="comment">//// 自己的ip地址</span></span><br><span class="line">                  <span class="attr">&quot;IPPrefixLen&quot;</span>: <span class="number">16</span>,</span><br><span class="line">                  <span class="attr">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                  <span class="attr">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                  <span class="attr">&quot;GlobalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                  <span class="attr">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:03&quot;</span>,</span><br><span class="line">                  <span class="attr">&quot;DriverOpts&quot;</span>: <span class="literal">null</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure>



<p>两个tomcat试试相互通信：</p>
<p>登录其中一个容器去curl另外一个tomcat服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:38:20]</span></span><br><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND             CREATED              STATUS              PORTS                    NAMES</span><br><span class="line">7610171c5d1b   tomcat_test:1.0   <span class="string">&quot;catalina.sh run&quot;</span>   About a minute ago   Up About a minute   0.0.0.0:8082-&gt;8080/tcp   mytomcat02</span><br><span class="line">0c18fe55b147   tomcat_test:1.0   <span class="string">&quot;catalina.sh run&quot;</span>   4 minutes ago        Up 4 minutes        0.0.0.0:8081-&gt;8080/tcp   mytomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:38:22]</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it 7610171c5d1b bash</span><br><span class="line">root@7610171c5d1b:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># ping 172.17.0.2</span></span><br><span class="line">bash: ping: <span class="built_in">command</span> not found</span><br><span class="line">root@7610171c5d1b:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># curl http://172.17.0.2:8080/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/10.0.14&lt;/title&gt;</span><br><span class="line">        &lt;link href=<span class="string">&quot;favicon.ico&quot;</span> rel=<span class="string">&quot;icon&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;image/x-icon&quot;</span> /&gt;</span><br><span class="line">        &lt;link href=<span class="string">&quot;tomcat.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">		//省略</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<h2 id="自定义网桥"><a href="#自定义网桥" class="headerlink" title="自定义网桥"></a>自定义网桥</h2><p>上面的这种默认网桥设置有一个问题，就是不同项目的容器会相互占用带宽。</p>
<p><strong>一般在使用docker网桥实现容器和容器通信时，都是站在一个应用角度来进行容器通信的！！！</strong></p>
<p>比如说项目A需要MySQL和Redis，项目B也需要MySQL和Redis。但项目A和B项目之间的MySQL其实是不需要通信的，只是在单个项目里的容器需要通信（保证项目A的MySQL和Redis在同一个网桥，项目B也同理即可！）</p>
<ul>
<li>查看docker网桥配置</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:44:11]</span></span><br><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">ec66f3dbb379   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">592291e47ef8   host      host      <span class="built_in">local</span></span><br><span class="line">8e92445b9a78   none      null      <span class="built_in">local</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>创建自定义网桥:<code>docker network create ems</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:45:46]</span></span><br><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">ec66f3dbb379   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">592291e47ef8   host      host      <span class="built_in">local</span></span><br><span class="line">8e92445b9a78   none      null      <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:45:49]</span></span><br><span class="line">$ docker network create ems</span><br><span class="line">de24154ff457963ba66f55126f40e08b9eb279d3ac3469b346884cde1bbe3665</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:46:26] C:125</span></span><br><span class="line">$ docker network create -d bridge ems02  //这种是全称，也可以</span><br><span class="line">47e6f8945697b2e1289da351777996ef932e4e652687a3b0d6560b0974a058c3</span><br><span class="line"></span><br><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">ec66f3dbb379   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">de24154ff457   ems       bridge    <span class="built_in">local</span></span><br><span class="line">47e6f8945697   ems02     bridge    <span class="built_in">local</span></span><br><span class="line">592291e47ef8   host      host      <span class="built_in">local</span></span><br><span class="line">8e92445b9a78   none      null      <span class="built_in">local</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>启动容器时指定网桥：<code>docker run -d -p 8083:8080 --name mytomcat03 --network ems tomcat_test:1.0</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:47:49]</span></span><br><span class="line">$ docker run -d -p 8083:8080 --name mytomcat03 --network ems tomcat_test:1.0</span><br><span class="line">5994ef7b985f2674118dbd360a57061c78a141791d5c8a952d652a0b7139429d</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:48:54]</span></span><br><span class="line">$ docker inspect 5994ef</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;ems&quot;</span>: &#123;  // 使用的网桥是ems</span><br><span class="line">                    <span class="string">&quot;IPAMConfig&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Aliases&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;5994ef7b985f&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="string">&quot;NetworkID&quot;</span>: <span class="string">&quot;de24154ff457963ba66f55126f40e08b9eb279d3ac3469b346884cde1bbe3665&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;6c77547bf6b2ea8aa86644fc0def0566aa547b4afb54ead619a1d5e7039a796c&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.18.0.1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.18.0.2&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">                    <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">                    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:12:00:02&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;DriverOpts&quot;</span>: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:49:10]</span></span><br><span class="line">$ docker run -d -p 8084:8080 --name mytomcat04 --network ems tomcat_test:1.0</span><br><span class="line">cf3de23b6eae3791ebf4146cbb277054e67c8f98186fa2b2a28875ae45fc9fc7</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:50:03]</span></span><br><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND             CREATED              STATUS              PORTS                    NAMES</span><br><span class="line">cf3de23b6eae   tomcat_test:1.0   <span class="string">&quot;catalina.sh run&quot;</span>   4 seconds ago        Up 3 seconds        0.0.0.0:8084-&gt;8080/tcp   mytomcat04</span><br><span class="line">5994ef7b985f   tomcat_test:1.0   <span class="string">&quot;catalina.sh run&quot;</span>   About a minute ago   Up About a minute   0.0.0.0:8083-&gt;8080/tcp   mytomcat03</span><br><span class="line">7610171c5d1b   tomcat_test:1.0   <span class="string">&quot;catalina.sh run&quot;</span>   13 minutes ago       Up 13 minutes       0.0.0.0:8082-&gt;8080/tcp   mytomcat02</span><br><span class="line">0c18fe55b147   tomcat_test:1.0   <span class="string">&quot;catalina.sh run&quot;</span>   16 minutes ago       Up 16 minutes       0.0.0.0:8081-&gt;8080/tcp   mytomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:50:07]</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;ems&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;IPAMConfig&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Aliases&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;cf3de23b6eae&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="string">&quot;NetworkID&quot;</span>: <span class="string">&quot;de24154ff457963ba66f55126f40e08b9eb279d3ac3469b346884cde1bbe3665&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;b75f85b1a14d986f134d4407dada996dda43c5f92a64df0ef7cb06ad0e83706f&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.18.0.1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.18.0.3&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">                    <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">                    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:12:00:03&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;DriverOpts&quot;</span>: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>一旦在启动容器时指定了网桥，网桥就会给容器分配一个网桥的ip，同时会给容器的名字和ip做一个映射，类似于DNS，这样的话，我们可以登录到tomcat04 去访问mytomcat03:<code>curl http://mytomcat03:8080/  </code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:50:38]</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it cf3de23b6eae bash</span><br><span class="line">root@cf3de23b6eae:/usr/<span class="built_in">local</span>/tomcat<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">root@cf3de23b6eae:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># curl http://mytomcat03:8080/  </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/10.0.14&lt;/title&gt;</span><br><span class="line">        &lt;link href=<span class="string">&quot;favicon.ico&quot;</span> rel=<span class="string">&quot;icon&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;image/x-icon&quot;</span> /&gt;</span><br><span class="line">        &lt;link href=<span class="string">&quot;tomcat.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<ul>
<li>删除网桥:<code>docker network rm aa</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:54:58]</span></span><br><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">ec66f3dbb379   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">de24154ff457   ems       bridge    <span class="built_in">local</span></span><br><span class="line">47e6f8945697   ems02     bridge    <span class="built_in">local</span></span><br><span class="line">592291e47ef8   host      host      <span class="built_in">local</span></span><br><span class="line">8e92445b9a78   none      null      <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:55:12]</span></span><br><span class="line">$ docker network create aa</span><br><span class="line">0e179eff1eacc8216628e983c7bc655e1089d42db8c45df7dbb67eed8d189393</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:55:22]</span></span><br><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">0e179eff1eac   aa        bridge    <span class="built_in">local</span></span><br><span class="line">ec66f3dbb379   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">de24154ff457   ems       bridge    <span class="built_in">local</span></span><br><span class="line">47e6f8945697   ems02     bridge    <span class="built_in">local</span></span><br><span class="line">592291e47ef8   host      host      <span class="built_in">local</span></span><br><span class="line">8e92445b9a78   none      null      <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:55:29]</span></span><br><span class="line">$ docker network rm aa</span><br><span class="line">aa</span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:55:35]</span></span><br><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">ec66f3dbb379   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">de24154ff457   ems       bridge    <span class="built_in">local</span></span><br><span class="line">47e6f8945697   ems02     bridge    <span class="built_in">local</span></span><br><span class="line">592291e47ef8   host      host      <span class="built_in">local</span></span><br><span class="line">8e92445b9a78   none      null      <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:55:41]</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure>



<ul>
<li>查看网桥的信息</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:55:35]</span></span><br><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">ec66f3dbb379   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">de24154ff457   ems       bridge    <span class="built_in">local</span></span><br><span class="line">47e6f8945697   ems02     bridge    <span class="built_in">local</span></span><br><span class="line">592291e47ef8   host      host      <span class="built_in">local</span></span><br><span class="line">8e92445b9a78   none      null      <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shengbinbin @ binshow in ~ [21:55:41]</span></span><br><span class="line">$ docker inspect ems</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ems&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;de24154ff457963ba66f55126f40e08b9eb279d3ac3469b346884cde1bbe3665&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2021-12-24T13:45:55.531687257Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;172.18.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.18.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        // 这个网桥下有两个活跃的容器：</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;5994ef7b985f2674118dbd360a57061c78a141791d5c8a952d652a0b7139429d&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;mytomcat03&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;6c77547bf6b2ea8aa86644fc0def0566aa547b4afb54ead619a1d5e7039a796c&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:12:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;172.18.0.2/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;cf3de23b6eae3791ebf4146cbb277054e67c8f98186fa2b2a28875ae45fc9fc7&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;mytomcat04&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;b75f85b1a14d986f134d4407dada996dda43c5f92a64df0ef7cb06ad0e83706f&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:12:00:03&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;172.18.0.3/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="数据卷配置"><a href="#数据卷配置" class="headerlink" title="数据卷配置"></a>数据卷配置</h1><p><strong>数据卷的作用是使得容器和宿主机之间实现数据共享。</strong></p>
<ul>
<li>数据卷可以在容器之间共享和重用</li>
<li><strong>对数据卷的修改会立即生效</strong></li>
<li>对数据卷的更新不会影响到镜像，镜像是可读层！</li>
<li>数据卷默认会一直存在，及时容器被删除</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 先启动一个tomcat 容器</span></span><br><span class="line">➜  docker_file docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND             CREATED         STATUS         PORTS      NAMES</span><br><span class="line">e258e8ddbfb9   tomcat_test:1.0   <span class="string">&quot;catalina.sh run&quot;</span>   2 minutes ago   Up 2 minutes   8080/tcp   confident_ptolemy</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">➜  docker_file docker <span class="built_in">exec</span> -it e258 bash</span><br><span class="line">root@e258e8ddbfb9:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@e258e8ddbfb9:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@e258e8ddbfb9:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/tomcat/webapps</span><br><span class="line">root@e258e8ddbfb9:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 将容器内部的webapp目录拷贝到外部的 docker_file 目录中</span></span><br><span class="line">➜  ~ docker cp e258:/usr/<span class="built_in">local</span>/tomcat/webapps ./docker_file</span><br><span class="line">➜  ~</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 重新以数据卷的配置开启一个tomcat08</span></span><br><span class="line">➜  ~ docker run -d -p 8081:8080 --name tomcat08 -v /Users/shengbinbin/docker_file/webapps:/usr/<span class="built_in">local</span>/tomcat/webapps tomcat_test:1.0</span><br><span class="line">f5c6546b311c8cc69f8092a073b590babdd93e989526011e4addbdbf60e4454b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#4. 在宿主机上的目录webapps进行修改,z 增加一个页面</span></span><br><span class="line">➜  webapps ls</span><br><span class="line">ROOT         docs         examples     host-manager manager</span><br><span class="line">➜  webapps mkdir ems</span><br><span class="line">➜  webapps touch index.html</span><br><span class="line">➜  webapps vim index.html</span><br><span class="line">➜  webapps cat index.html</span><br><span class="line">&lt;h1&gt;HelloWorld&lt;h1&gt;</span><br><span class="line">➜  webapps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#5. 查看docker容器内部的 日志 docker logs -f id , 可以看到刚刚加入的ems文件夹被重新部署了</span></span><br><span class="line">26-Dec-2021 06:57:33.665 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/<span class="built_in">local</span>/tomcat/webapps/manager] has finished <span class="keyword">in</span> [99] ms</span><br><span class="line">26-Dec-2021 06:57:33.670 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler [<span class="string">&quot;http-nio-8080&quot;</span>]</span><br><span class="line">26-Dec-2021 06:57:33.682 INFO [main] org.apache.catalina.startup.Catalina.start Server startup <span class="keyword">in</span> [1573] milliseconds</span><br><span class="line">26-Dec-2021 07:00:34.455 INFO [Catalina-utility-2] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/usr/<span class="built_in">local</span>/tomcat/webapps/ems]</span><br><span class="line">26-Dec-2021 07:00:34.532 INFO [Catalina-utility-2] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/<span class="built_in">local</span>/tomcat/webapps/ems] has finished <span class="keyword">in</span> [77] ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>浏览器也确实能够访问到刚刚部署上去的页面：</p>
<p><img src="https://raw.githubusercontent.com/binshow/img/master/20211226150506.png" alt="20211226150506"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND             CREATED         STATUS         PORTS                    NAMES</span><br><span class="line">f5c6546b311c   tomcat_test:1.0   <span class="string">&quot;catalina.sh run&quot;</span>   8 minutes ago   Up 8 minutes   0.0.0.0:8081-&gt;8080/tcp   tomcat08</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入容器，查看对应的目录，发现ems文件夹也确实存在</span></span><br><span class="line">➜  ~ docker <span class="built_in">exec</span> -it f5c6 bash</span><br><span class="line">root@f5c6546b311c:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@f5c6546b311c:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  ems  examples  host-manager  manager</span><br><span class="line">root@f5c6546b311c:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment">#</span></span><br></pre></td></tr></table></figure>





<p>数据卷操作：</p>
<ul>
<li>自定义数据目录： docker run -v 绝对路径：容器内路径</li>
<li>自动创建数据卷： docker run -v 卷名（自动创建）：容器内路径</li>
<li>查看数据卷：<code>docker volume ls</code></li>
<li>查看数据卷细节： ``docker volume inspect 券名`</li>
<li>创建数据卷： ``docker volume create 卷名`</li>
<li>删除没有使用的数据卷：<code>docker volume prune</code></li>
<li>删除指定的数据卷：``docker volume rm 券名`</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">➜  ~ docker volume create aa</span><br><span class="line">aa</span><br><span class="line">➜  ~ docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>     aa</span><br><span class="line">➜  ~ docker volume inspect aa</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2021-12-26T07:11:25Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/aa/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;aa&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure>

</div><div class="article-licensing box"><div class="licensing-title"><p>Docker（三）原理解析</p><p><a href="http://example.com/2021/12/24/Docker（三）原理解析/">http://example.com/2021/12/24/Docker（三）原理解析/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>binshow</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-12-24</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-12-26</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/" alt="支付宝"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/12/24/Docker%EF%BC%88%E5%9B%9B%EF%BC%89%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Docker（四）常见服务</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/12/24/Docker%EF%BC%88%E4%BA%8C%EF%BC%89%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4/"><span class="level-item">Docker（二）常见命令</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="binshow"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">binshow</p><p class="is-size-6 is-block">后台开发工程师</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>安徽</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">103</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">1</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">21</p></a></div></div></nav></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">技术</span></span><span class="level-end"><span class="level-item tag">88</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-02T13:31:23.000Z">2022-01-02</time></p><p class="title"><a href="/2022/01/02/Go%E6%93%8D%E4%BD%9CElasticsearch/">Go操作Elasticsearch</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-30T14:21:57.000Z">2021-12-30</time></p><p class="title"><a href="/2021/12/30/Go-Learning%EF%BC%88%E5%8D%81%EF%BC%89Web/">Go_Learning（十）Web</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-30T14:21:42.000Z">2021-12-30</time></p><p class="title"><a href="/2021/12/30/Go-Learning%EF%BC%88%E4%B9%9D%EF%BC%89%E6%B5%8B%E8%AF%95/">Go_Learning（九）测试</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-24T12:21:56.000Z">2021-12-24</time></p><p class="title"><a href="/2021/12/24/Docker%EF%BC%88%E5%9B%9B%EF%BC%89%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1/">Docker（四）常见服务</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-24T12:21:43.000Z">2021-12-24</time></p><p class="title"><a href="/2021/12/24/Docker%EF%BC%88%E4%B8%89%EF%BC%89%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">Docker（三）原理解析</a></p></div></article></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="漫漫转码路" height="28"></a><p class="is-size-7"><span>&copy; 2022 binshow</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>