<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Redis（一）数据结构类型 - 漫漫转码路</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="漫漫转码路"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="漫漫转码路"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Redis为什么这么快呢？  基于内存操作 优化后的数据结构 单线程"><meta property="og:type" content="blog"><meta property="og:title" content="Redis（一）数据结构类型"><meta property="og:url" content="http://example.com/2021/05/13/Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/"><meta property="og:site_name" content="漫漫转码路"><meta property="og:description" content="Redis为什么这么快呢？  基于内存操作 优化后的数据结构 单线程"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/gallery/covers/Redis1.jpeg"><meta property="article:published_time" content="2021-05-13T02:32:33.000Z"><meta property="article:modified_time" content="2021-05-13T04:22:59.518Z"><meta property="article:author" content="binshow"><meta property="article:tag" content="Redis"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/gallery/covers/Redis1.jpeg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2021/05/13/Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/"},"headline":"Redis（一）数据结构类型","image":[],"datePublished":"2021-05-13T02:32:33.000Z","dateModified":"2021-05-13T04:22:59.518Z","author":{"@type":"Person","name":"binshow"},"description":"Redis为什么这么快呢？  基于内存操作 优化后的数据结构 单线程"}</script><link rel="canonical" href="http://example.com/2021/05/13/Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="漫漫转码路" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/gallery/covers/Redis1.jpeg" alt="Redis（一）数据结构类型"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-05-13T02:32:33.000Z" title="2021/5/13上午10:32:33">2021-05-13</time>发表</span><span class="level-item"><time dateTime="2021-05-13T04:22:59.518Z" title="2021/5/13下午12:22:59">2021-05-13</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span><span class="level-item">26 分钟读完 (大约3867个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Redis（一）数据结构类型</h1><div class="content"><p>Redis为什么这么快呢？</p>
<ul>
<li>基于内存操作</li>
<li>优化后的数据结构</li>
<li>单线程</li>
</ul>
<span id="more"></span>



<h1 id="键和值的保存方式"><a href="#键和值的保存方式" class="headerlink" title="键和值的保存方式"></a>键和值的保存方式</h1><p>在Redis中，键值对是按一定的数据结构来组织的，操作键值对最终就是对数据结构进行增删改查操作，所以高效的数据结构是Redis快速处理数据的基础。</p>
<blockquote>
<p>String (字符串)、List (列表)、Hash (哈希)、Set (集合)和Sorted Set (有序集合)这些只是Redis键值对中<strong>值的数据类型</strong>，也就是数据的保存形式。而这里，我们说的数据结构，是要去看看它们的底层实现</p>
</blockquote>
<p><img src="Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt="数据类型和数据结构的关系"></p>
<h2 id="全局哈希表"><a href="#全局哈希表" class="headerlink" title="全局哈希表"></a>全局哈希表</h2><p>为了实现从键到值的快速访问，Redis 使用了一个哈希表来保存所有键值对。</p>
<blockquote>
<p>一个哈希表，其实就是一个数组，数组的每个元素称为一个哈希桶。一个哈希表是由多个哈希桶组成的，每个哈希桶中保存了键值对数据。</p>
<p>其实，哈希桶中的元素保存的并不是值本身，而是指向具体值的指针。这也就是说，不管值是String，还是集合类型，哈希桶中的元素都是指向它们的指针。</p>
</blockquote>
<p><img src="Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/%E5%85%A8%E5%B1%80%E5%93%88%E5%B8%8C%E8%A1%A8.png" alt="全局哈希表"></p>
<h2 id="为什么哈希操作会变慢"><a href="#为什么哈希操作会变慢" class="headerlink" title="为什么哈希操作会变慢"></a>为什么哈希操作会变慢</h2><p>当你往哈希表中写入更多数据时，哈希冲突是不可避免的问题。这里的哈希冲突，也就是指,两个key的哈希值和哈希桶计算对应关系时，正好落在了同一个哈希桶中。</p>
<p>Redis 解决哈希冲突的方式，就是链式哈希。<strong>链式哈希也很容易理解，就是指同一个哈希桶中的多个元素用一个链表来保存，它们之间依次用指针连接</strong></p>
<p><img src="Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/%E5%93%88%E5%B8%8C%E5%86%B2%E7%AA%81.png" alt="哈希冲突"></p>
<p>当链表长度过长时，会导致这个链上元素查找事件越来越久，是一个O(n)的操作。</p>
<h2 id="渐进式rehash"><a href="#渐进式rehash" class="headerlink" title="渐进式rehash"></a>渐进式rehash</h2><p>Redis 会对哈希表做 rehash 操作。rehash 也就是增加现有的哈希桶数量，让逐渐增多的 entry 元素能在更多的桶之间分散保存，减少单个桶中的元素数量，从而减少单个桶中的冲突。</p>
<p>其实，为了使 rehash 操作更高效，Redis 默认使用了两个全局哈希表：哈希表 1 和哈希表 2。一开始，当你刚插入数据时，默认使用哈希表 1，此时的哈希表 2 并没有被分配空间。随着数据逐步增多，Redis 开始执行 rehash，这个过程分为三步：</p>
<ol>
<li>给哈希表 2 分配更大的空间，例如是当前哈希表 1 大小的两倍；</li>
<li>把哈希表 1 中的数据重新映射并拷贝到哈希表 2 中；</li>
<li>释放哈希表 1 的空间。</li>
</ol>
<p><strong>第二步涉及大量的数据拷贝</strong>，如果一次性把哈希表 1 中的数据都迁移完，会造成 Redis 线程阻塞，无法服务其他请求。此时，Redis 就无法快速访问数据了。为了避免这个问题，Redis 采用了<strong>渐进式 rehash</strong>：</p>
<p>简单来说就是在第二步拷贝数据时，Redis 仍然正常处理客户端请求，每处理一个请求时，从哈希表 1 中的第一个索引位置开始，顺带着将这个索引位置上的所有 entries 拷贝到哈希表 2 中；等处理下一个请求时，再顺带拷贝哈希表 1 中的下一个索引位置的entries。</p>
<p><img src="Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/%E6%B8%90%E8%BF%9B%E5%BC%8Frehash.png" alt="渐进式rehash"></p>
<p>把一次性大量拷贝的开销，分摊到了多次处理请求的过程中，避免了耗时操作，保证了数据的快速访问。</p>
<h1 id="六种数据结构"><a href="#六种数据结构" class="headerlink" title="六种数据结构"></a>六种数据结构</h1><p><img src="Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6.png" alt="数据结构的时间复杂度"></p>
<h2 id="简单动态字符串SDS"><a href="#简单动态字符串SDS" class="headerlink" title="简单动态字符串SDS"></a>简单动态字符串SDS</h2><p>simple dynamic string</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span> </span><br><span class="line">  <span class="keyword">int</span> len; <span class="comment">//记录字节数组中已经使用的长度 == 字符串的长度    4个字节</span></span><br><span class="line">  <span class="keyword">int</span> free; <span class="comment">//记录字节数组中未使用的长度							      4个字节</span></span><br><span class="line">  <span class="keyword">char</span>[] buf; <span class="comment">//字节数组，保存字符串    4个字节</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="和C中字符串的区别"><a href="#和C中字符串的区别" class="headerlink" title="和C中字符串的区别"></a>和C中字符串的区别</h3><ol>
<li><strong>常数复杂度获取字符串的长度</strong>,C中的字符串获取长度需要On，而SDS中保存了len属性</li>
<li><strong>杜绝了缓冲区溢出</strong>。C语言中进行字符串拼接需要先分配足够的内存，否则会发生缓冲区溢出。而SDS中的API会自动的先检查空间是否足够，因为记录了字符串长度，所以比较快。（如果空间不够，不仅会分配足够的空间，还会分配足够的未使用空间）</li>
<li><strong>减少了修改字符串带来的内存重分配</strong>。C中字符串每次赠长或缩短，都要进行内存重分配，否则会发生缓冲区溢出和内存泄露的问题。redis中进行会修改字符串，所以会有未使用的空间可以使用空间预分配和惰性空间释放。</li>
<li><strong>二进制安全</strong>。C字符串末尾是\0,所以不能包含空字符串，只能保存文本数据，不能保存二进制数据。而SDS是可以的。</li>
<li><strong>兼容部分C字符串的函数</strong>。</li>
</ol>
<h3 id="SDS是如何减少内存重分配的"><a href="#SDS是如何减少内存重分配的" class="headerlink" title="SDS是如何减少内存重分配的"></a>SDS是如何减少内存重分配的</h3><ol>
<li><strong>空间预分配</strong>：当用SDS的API对SDS进行修改的时候，不仅会分配修改所必须使用的空间，还会分配额外的未使用空间。在扩展SDS空间之前，会先检查未使用的空间是否足够，如果足够就直接使用而无须执行内存重分配。通过这种策略：连续赠长N次字符串的内存重分配次数由N次降低为最多N次。</li>
<li><strong>惰性空间释放</strong>：SDS进行缩短操作的时候，不会立即内存重分配来回收缩短后多出来的字节，而是使用free属性记录下来。</li>
</ol>
<h3 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h3><p>保存一个10位数的图片id和图片存储id：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">photo_id:  <span class="number">1101000051</span></span><br><span class="line">photo_obj_id: <span class="number">3301000051</span></span><br></pre></td></tr></table></figure>

<p>我们保存了 1 亿张图片的信息，用了约 6.4GB 的内存，一个图片 ID 和图片存储对象 ID 的记录平均用了 64 字节。但实际上实际只需要 16 字节就可以了（两个 8 字节的Long 类型表示这两个 ID。）。</p>
<p>但其实，除了记录实际数据，String 类型还需要额外的内存空间记录数据长度、空间使用等信息，这些信息也叫作元数据。当实际保存的数据较小时，元数据的空间开销就显得比较大了，有点“喧宾夺主”的意思。</p>
<p>String 类型具体是怎么保存数据的呢？我来解释一下。</p>
<ul>
<li>当你保存 64 位有符号整数时，String 类型会把它保存为一个 8 字节的 Long 类型整数，这种保存方式通常也叫作 int 编码方式。</li>
<li>当你保存的数据中包含字符时，会用SDS来保存</li>
</ul>
<p>针对于RedisObject的优化：</p>
<ol>
<li>一方面，当保存的是 Long 类型整数时，RedisObject 中的指针就直接赋值为整数数据了，这样就不用额外的指针再指向整数了，节省了指针的空间开销。</li>
<li>另一方面，当保存的是字符串数据，并且字符串小于等于 44 字节时，RedisObject 中的元数据、指针和 SDS 是一块连续的内存区域，这样就可以避免内存碎片。这种布局方式也被称为 embstr 编码方式。</li>
<li>当字符串大于 44 字节时，SDS 的数据量就开始变多了，Redis 就不再把 SDS 和RedisObject 布局在一起了，而是会给 SDS 分配独立的空间，并用指针指向 SDS 结构。这种布局方式被称为 raw 编码模式。</li>
</ol>
<p><img src="Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/SDS%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F.png" alt="SDS编码方式"></p>
<p>因为 10 位数的图片 ID 和图片存储对象 ID 是 Long 类型整数，所以可以直接用 int 编码的 RedisObject 保存。每个 int 编码的 RedisObject 元数据部分占 8 字节，指针部分被直接赋值为 8 字节的整数了。此时，每个 ID 会使用 16 字节，加起来一共是 32 字节。但是，另外的 32 字节去哪儿了呢？</p>
<p>Redis 会使用一个全局哈希表保存所有键值对，哈希表的每一项是一个 dictEntry 的结构体，用来指向一个键值对。dictEntry 结构中有三个 8 字节的指针，分别指向 key、value 以及下一个 dictEntry，三个指针共 24 字节，</p>
<p><img src="Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/dictEntry.png" alt="dictEntry"></p>
<p>但是，这三个指针只有 24 字节，为什么会占用了 32 字节呢？这就要提到 Redis 使用的内存分配库 jemalloc 了。jemalloc 在分配内存时，会根据我们申请的字节数 N，找一个比 N 大，但是最接近 N 的2 的幂次数作为分配的空间，这样可以减少频繁分配的次数。举个例子。如果你申请 6 字节空间，jemalloc 实际会分配 8 字节空间；如果你申请 24 字节空间，jemalloc 则会分配 32 字节。所以，在我们刚刚说的场景里，dictEntry 结构就占用了 32 字节。</p>
<h2 id="双向列表"><a href="#双向列表" class="headerlink" title="双向列表"></a>双向列表</h2><h2 id="压缩列表"><a href="#压缩列表" class="headerlink" title="压缩列表"></a>压缩列表</h2><p>压缩列表实际上类似于一个数组，数组中的每一个元素都对应保存一个数据。和数组不同的是，压缩列表在表头有三个字段 zlbytes、zltail 和 zllen，分别表示<strong>列表长度、列表尾的偏移量和列表中的 entry</strong> 个数；压缩列表在表尾还有一个 zlend，表示列表结束。</p>
<p><img src="Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8.png" alt="压缩列表"></p>
<p>在压缩列表中，如果我们要查找定位第一个元素和最后一个元素，可以通过表头三个字段的长度直接定位，复杂度是 O(1)。而查找其他元素时，就没有这么高效了，只能逐个查找，此时的复杂度就是 O(N) 了。</p>
<p>压缩列表是一种非常紧凑的数据结构，占用的内存比链表要少。</p>
<h2 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h2><h2 id="跳表"><a href="#跳表" class="headerlink" title="跳表"></a>跳表</h2><p>有序链表只能逐一查找元素，导致操作起来非常缓慢，于是就出现了跳表。具体来说，跳表在链表的基础上，增加了多级索引，通过索引位置的几个跳转，实现数据的快速定位，</p>
<p><img src="Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/%E8%B7%B3%E8%A1%A8.png" alt="跳表"></p>
<h2 id="整形数组"><a href="#整形数组" class="headerlink" title="整形数组"></a>整形数组</h2><h2 id="RedisObject"><a href="#RedisObject" class="headerlink" title="RedisObject"></a>RedisObject</h2><p>因为 Redis 的数据类型有很多，而且，不同数据类型都有些相同的元数据要记录（比如最后一次访问的时间、被引用的次数等），所以，Redis 会用一个 RedisObject 结构体来统一记录这些元数据，同时指向实际数据。</p>
<p>一个 RedisObject 包含了 8 字节的元数据和一个 8 字节指针，这个指针再进一步指向具体数据类型的实际数据所在，例如指向 String 类型的 SDS 结构所在的内存地址，可以看一下下面的示意图。关于 RedisObject 的具体结构细节，我会在后面的课程中详细介绍，现在你只要了解它的基本结构和元数据开销就行了。</p>
<p><img src="Redis%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B/RedisObject.png" alt="RedisObject"></p>
<h1 id="不同操作的时间复杂度"><a href="#不同操作的时间复杂度" class="headerlink" title="不同操作的时间复杂度"></a>不同操作的时间复杂度</h1><p>第一，单元素操作，是指每一种集合类型对单个数据实现的增删改查操作。例如，Hash 类型的 HGET、HSET 和 HDEL，Set 类型的 SADD、SREM、SRANDMEMBER 等。这些操作的复杂度由集合采用的数据结构决定，例如，HGET、HSET 和 HDEL 是对哈希表做操作，所以它们的复杂度都是 O(1)；Set 类型用哈希表作为底层数据结构时，它的 SADD、SREM、SRANDMEMBER 复杂度也是 O(1)。这里，有个地方你需要注意一下，集合类型支持同时对多个元素进行增删改查，例如 Hash类型的 HMGET 和 HMSET，Set 类型的 SADD 也支持同时增加多个元素。此时，这些操作的复杂度，就是由单个元素操作复杂度和元素个数决定的。例如，HMSET 增加 M 个元素时，复杂度就从 O(1) 变成 O(M) 了。第二，范围操作，是指集合类型中的遍历操作，可以返回集合中的所有数据，比如 Hash类型的 HGETALL 和 Set 类型的 SMEMBERS，或者返回一个范围内的部分数据，比如 List类型的 LRANGE 和 ZSet 类型的 ZRANGE。这类操作的复杂度一般是 O(N)，比较耗时，我们应该尽量避免。不过，Redis 从 2.8 版本开始提供了 SCAN 系列操作（包括 HSCAN，SSCAN 和ZSCAN），这类操作实现了渐进式遍历，每次只返回有限数量的数据。这样一来，相比于HGETALL、SMEMBERS 这类操作来说，就避免了一次性返回所有元素而导致的 Redis 阻塞。第三，统计操作，是指集合类型对集合中所有元素个数的记录，例如 LLEN 和 SCARD。这类操作复杂度只有 O(1)，这是因为当集合类型采用压缩列表、双向链表、整数数组这些数据结构时，这些结构中专门记录了元素的个数统计，因此可以高效地完成相关操作。</p>
<p>第四，例外情况，是指某些数据结构的特殊记录，例如压缩列表和双向链表都会记录表头和表尾的偏移量。这样一来，对于 List 类型的 LPOP、RPOP、LPUSH、RPUSH 这四个操作来说，它们是在列表的头尾增删元素，这就可以通过偏移量直接定位，所以它们的复杂度也只有 O(1)，可以实现快速操作。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Redis（一）数据结构类型</p><p><a href="http://example.com/2021/05/13/Redis（一）数据结构类型/">http://example.com/2021/05/13/Redis（一）数据结构类型/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>binshow</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-05-13</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-05-13</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Redis/">Redis</a></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/" alt="支付宝"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/05/13/Redis%EF%BC%88%E4%BA%8C%EF%BC%89IO%E6%A8%A1%E5%9E%8B/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Redis（二）IO模型</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/05/12/MySQL%EF%BC%88%E5%85%AD%EF%BC%89%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"><span class="level-item">MySQL（六）高可用集群</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="binshow"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">binshow</p><p class="is-size-6 is-block">后台开发工程师</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>安徽</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">59</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">1</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">14</p></a></div></div></nav></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#键和值的保存方式"><span class="level-left"><span class="level-item">1</span><span class="level-item">键和值的保存方式</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#全局哈希表"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">全局哈希表</span></span></a></li><li><a class="level is-mobile" href="#为什么哈希操作会变慢"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">为什么哈希操作会变慢</span></span></a></li><li><a class="level is-mobile" href="#渐进式rehash"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">渐进式rehash</span></span></a></li></ul></li><li><a class="level is-mobile" href="#六种数据结构"><span class="level-left"><span class="level-item">2</span><span class="level-item">六种数据结构</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#简单动态字符串SDS"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">简单动态字符串SDS</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#和C中字符串的区别"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">和C中字符串的区别</span></span></a></li><li><a class="level is-mobile" href="#SDS是如何减少内存重分配的"><span class="level-left"><span class="level-item">2.1.2</span><span class="level-item">SDS是如何减少内存重分配的</span></span></a></li><li><a class="level is-mobile" href="#案例分析"><span class="level-left"><span class="level-item">2.1.3</span><span class="level-item">案例分析</span></span></a></li></ul></li><li><a class="level is-mobile" href="#双向列表"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">双向列表</span></span></a></li><li><a class="level is-mobile" href="#压缩列表"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">压缩列表</span></span></a></li><li><a class="level is-mobile" href="#哈希表"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">哈希表</span></span></a></li><li><a class="level is-mobile" href="#跳表"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">跳表</span></span></a></li><li><a class="level is-mobile" href="#整形数组"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">整形数组</span></span></a></li><li><a class="level is-mobile" href="#RedisObject"><span class="level-left"><span class="level-item">2.7</span><span class="level-item">RedisObject</span></span></a></li></ul></li><li><a class="level is-mobile" href="#不同操作的时间复杂度"><span class="level-left"><span class="level-item">3</span><span class="level-item">不同操作的时间复杂度</span></span></a></li></ul></div></div><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">技术</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-24T14:52:52.000Z">2021-08-24</time></p><p class="title"><a href="/2021/08/24/Java%E5%B9%B6%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89%E7%AE%A1%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/">Java并发（二）管程和线程</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-24T14:52:02.000Z">2021-08-24</time></p><p class="title"><a href="/2021/08/24/Java%E5%B9%B6%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB/">Java并发（三）并发工具类</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-24T14:50:41.000Z">2021-08-24</time></p><p class="title"><a href="/2021/08/24/Java%E5%B9%B6%E5%8F%91%EF%BC%88%E5%9B%9B%EF%BC%89%E5%B9%B6%E5%8F%91%E9%9B%86%E5%90%88/">Java并发（四）并发集合</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-24T14:18:04.000Z">2021-08-24</time></p><p class="title"><a href="/2021/08/24/Java%E5%B9%B6%E5%8F%91%EF%BC%88%E5%85%AD%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%B1%A0/">Java并发（六）线程池</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-24T14:17:29.000Z">2021-08-24</time></p><p class="title"><a href="/2021/08/24/Java%E5%B9%B6%E5%8F%91%EF%BC%88%E4%BA%94%EF%BC%89%E5%8E%9F%E5%AD%90%E7%B1%BB/">Java并发（五）原子类</a></p></div></article></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="漫漫转码路" height="28"></a><p class="is-size-7"><span>&copy; 2021 binshow</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>