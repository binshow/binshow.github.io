<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ElasticSearch从入门到实战 - 漫漫转码路</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="漫漫转码路"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="漫漫转码路"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="本篇主要讲述了elasticsearch入门的一些基本概念（来源：江南一点雨）  简介 安装 十大核心概念 分词器 索引基本操作 文档基本操作 版本控制 倒排索引"><meta property="og:type" content="blog"><meta property="og:title" content="ElasticSearch从入门到实战"><meta property="og:url" content="http://example.com/2021/06/29/ElasticSearch%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/"><meta property="og:site_name" content="漫漫转码路"><meta property="og:description" content="本篇主要讲述了elasticsearch入门的一些基本概念（来源：江南一点雨）  简介 安装 十大核心概念 分词器 索引基本操作 文档基本操作 版本控制 倒排索引"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/gallery/covers/elasticsearch.jpeg"><meta property="article:published_time" content="2021-06-29T10:26:25.000Z"><meta property="article:modified_time" content="2021-12-25T14:35:07.015Z"><meta property="article:author" content="binshow"><meta property="article:tag" content="ElasticSearch"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/gallery/covers/elasticsearch.jpeg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2021/06/29/ElasticSearch%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/"},"headline":"ElasticSearch从入门到实战","image":[],"datePublished":"2021-06-29T10:26:25.000Z","dateModified":"2021-12-25T14:35:07.015Z","author":{"@type":"Person","name":"binshow"},"description":"本篇主要讲述了elasticsearch入门的一些基本概念（来源：江南一点雨）  简介 安装 十大核心概念 分词器 索引基本操作 文档基本操作 版本控制 倒排索引"}</script><link rel="canonical" href="http://example.com/2021/06/29/ElasticSearch%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="漫漫转码路" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/gallery/covers/elasticsearch.jpeg" alt="ElasticSearch从入门到实战"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-06-29T10:26:25.000Z" title="2021/6/29 下午6:26:25">2021-06-29</time>发表</span><span class="level-item"><time dateTime="2021-12-25T14:35:07.015Z" title="2021/12/25 下午10:35:07">2021-12-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span><span class="level-item">36 分钟读完 (大约5382个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">ElasticSearch从入门到实战</h1><div class="content"><p>本篇主要讲述了elasticsearch入门的一些基本概念（来源：江南一点雨）</p>
<ul>
<li>简介</li>
<li>安装</li>
<li>十大核心概念</li>
<li>分词器</li>
<li>索引基本操作</li>
<li>文档基本操作</li>
<li>版本控制</li>
<li>倒排索引</li>
</ul>
<span id="more"></span>

<h1 id="ElasticSearch简介"><a href="#ElasticSearch简介" class="headerlink" title="ElasticSearch简介"></a>ElasticSearch简介</h1><h2 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h2><p>全文检索是计算机程序通过扫描文章中的每一一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置。当用户查询时根据建立的索引查找，类似于通过字典的检索字表查字的过程。</p>
<p>一般会分为两个步骤：</p>
<ul>
<li>建立索引： 文本 —&gt; 切分 —&gt; 词</li>
<li>检索</li>
</ul>
<p>全文检索(ull-Text Retrieval以文本作为检索对象，找出含有指定词汇的文本。全面、准确和快速是衡量全文检索系统的关键指标。</p>
<ul>
<li> 只处理文本、不处理语义</li>
<li>搜索时英文不区分大小写</li>
<li>结果列表有相关度排序</li>
</ul>
<h2 id="Lucene"><a href="#Lucene" class="headerlink" title="Lucene"></a>Lucene</h2><p>Lucene 是一个开源、免费、高性能、纯 Java 编写的全文检索引擎，可以算是开源领域最好的全文检索工具包。</p>
<p>在实际开发中，Lucene 几乎适用于任何需要全文检索的场景，所以 Lucene 先后发展出好多语言版本，例如 C++、C#、Python 等。</p>
<p>早在 2005 年，Lucene 就升级为 Apache 顶级开源项目。它的作者是 Doug Cutting，有的人可能没听过这这个人，不过你肯定听过他的另一个大名鼎鼎的作品 Hadoop。</p>
<p>不过需要注意的是，Lucene 只是一个工具包，并非一个完整的搜索引擎，开发者可以基于 Lucene 来开发完整的搜索引擎。比较著名的有 Solr、ElasticSearch，不过在分布式和大数据环境下，ElasticSearch 更胜一筹。</p>
<p>Lucene 主要有如下特点：</p>
<ul>
<li>简单</li>
<li>跨语言</li>
<li>强大的搜索引擎</li>
<li>索引速度快</li>
<li>索引文件兼容不同平台</li>
</ul>
<h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><p>ElasticSearch 是一个<strong>分布式、可扩展、近实时性的</strong>高性能搜索与数据分析引擎。ElasticSearch 基于 Java 编写，通过进一步封装 Lucene，将搜索的复杂性屏蔽起来，开发者只需要一套简单的 RESTful API 就可以操作全文检索。</p>
<p>ElasticSearch 在分布式环境下表现优异，这也是它比较受欢迎的原因之一。它支持 PB 级别的结构化或非结构化海量数据处理</p>
<p>整体上来说，ElasticSearch 有三大功能：</p>
<ul>
<li>数据搜集</li>
<li>数据分析</li>
<li>数据存储</li>
</ul>
<p>ElasticSearch 的主要特点：</p>
<ol>
<li>分布式文件存储。</li>
<li>实时分析的分布式搜索引擎。</li>
<li>高可拓展性。</li>
<li>可插拔的插件支持。</li>
</ol>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>首先打开 Es 官网，找到 Elasticsearch：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/elasticsearch/">https://www.elastic.co/cn/elasticsearch/</a></li>
<li>点击 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.13/brew.html%EF%BC%8C%E6%8C%89%E7%85%A7%E6%8F%90%E7%A4%BA%E5%AE%89%E8%A3%85">https://www.elastic.co/guide/en/elasticsearch/reference/7.13/brew.html，按照提示安装</a></li>
<li>打开终端</li>
</ul>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">shengbinbin@192 ~ % brew list   //查看所有homebrew安装的软件</span><br><span class="line">==&gt; Formulae</span><br><span class="line">autoconf		icu4c			maven			pkg-config</span><br><span class="line">brotli			jemalloc		mysql			protobuf</span><br><span class="line">c-ares			kibana-full		nghttp2			redis</span><br><span class="line">elasticsearch-full	libev			node			tcl-tk</span><br><span class="line">freetype		libpng			openjdk</span><br><span class="line">git-gui			libuv			openjdk@11</span><br><span class="line">gradle			m4			openssl@1.1</span><br><span class="line"></span><br><span class="line">shengbinbin@192 ~ % brew info elasticsearch-full  //查看安装的elasticsearch-full详细信息</span><br><span class="line">elastic/tap/elasticsearch-full: stable 7.13.2</span><br><span class="line">Distributed search &amp; analytics engine</span><br><span class="line">https://www.elastic.co/products/elasticsearch</span><br><span class="line">Conflicts with:</span><br><span class="line">  elasticsearch</span><br><span class="line">/opt/homebrew/Cellar/elasticsearch-full/7.13.2 (957 files, 504.8MB) *</span><br><span class="line">  Built from <span class="built_in">source</span> on 2021-06-29 at 20:46:00</span><br><span class="line">From: https://github.com/elastic/homebrew-tap/blob/HEAD/Formula/elasticsearch-full.rb</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Data:    /opt/homebrew/var/lib/elasticsearch/elasticsearch_shengbinbin/</span><br><span class="line">Logs:    /opt/homebrew/var/<span class="built_in">log</span>/elasticsearch/elasticsearch_shengbinbin.log</span><br><span class="line">Plugins: /opt/homebrew/var/elasticsearch/plugins/</span><br><span class="line">Config:  /opt/homebrew/etc/elasticsearch/</span><br><span class="line"></span><br><span class="line">To have launchd start elastic/tap/elasticsearch-full now and restart at login:</span><br><span class="line">  brew services start elastic/tap/elasticsearch-full</span><br><span class="line">Or, <span class="keyword">if</span> you don<span class="string">&#x27;t want/need a background service you can just run:</span></span><br><span class="line"><span class="string">  elasticsearch</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>



<p>目录含义如下：</p>
<table>
<thead>
<tr>
<th align="left">目录</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">modules</td>
<td align="left">依赖模块目录</td>
</tr>
<tr>
<td align="left">lib</td>
<td align="left">第三方依赖库</td>
</tr>
<tr>
<td align="left">logs</td>
<td align="left">输出日志目录</td>
</tr>
<tr>
<td align="left">plugins</td>
<td align="left">插件目录</td>
</tr>
<tr>
<td align="left">bin</td>
<td align="left">可执行文件目录</td>
</tr>
<tr>
<td align="left">config</td>
<td align="left">配置文件目录</td>
</tr>
<tr>
<td align="left">data</td>
<td align="left">数据存储目录</td>
</tr>
</tbody></table>
<p>启动方式：打开终端，直接输入elasticsearch即可启动。看到 started 表示启动成功。</p>
<p>默认监听的端口是 9200，所以浏览器直接输入 localhost:9200 可以查看节点信息。</p>
<p><img src="https://i.loli.net/2021/06/29/mEyj5dXWpu32bga.png"></p>
<p>节点的名字以及集群（默认是 elasticsearch）的名字，我们都可以自定义配置。</p>
<p>打开 config/elasticsearch.yml 文件，可以配置集群名称以及节点名称。配置文件内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"># ======================== Elasticsearch Configuration =========================</span><br><span class="line">#</span><br><span class="line"># NOTE: Elasticsearch comes with reasonable defaults for most settings.</span><br><span class="line">#       Before you set out to tweak and tune the configuration, make sure you</span><br><span class="line">#       understand what are you trying to accomplish and the consequences.</span><br><span class="line">#</span><br><span class="line"># The primary way of configuring a node is via this file. This template lists</span><br><span class="line"># the most important settings you may want to configure for a production cluster.</span><br><span class="line">#</span><br><span class="line"># Please consult the documentation for further information on configuration options:</span><br><span class="line"># https://www.elastic.co/guide/en/elasticsearch/reference/index.html</span><br><span class="line">#</span><br><span class="line"># ---------------------------------- Cluster -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Use a descriptive name for your cluster:</span><br><span class="line">#</span><br><span class="line">cluster.name: elasticsearch_shengbinbin   //可以在这里修改集群名称</span><br><span class="line">#</span><br><span class="line"># ------------------------------------ Node ------------------------------------</span><br><span class="line">#</span><br><span class="line"># Use a descriptive name for the node:</span><br><span class="line">#</span><br><span class="line">#node.name: node-1</span><br><span class="line">#</span><br><span class="line"># Add custom attributes to the node:</span><br><span class="line">#</span><br><span class="line">#node.attr.rack: r1</span><br><span class="line">#</span><br><span class="line"># ----------------------------------- Paths ------------------------------------</span><br><span class="line">#</span><br><span class="line"># Path to directory where to store the data (separate multiple locations by comma):</span><br><span class="line">#</span><br><span class="line">path.data: /opt/homebrew/var/lib/elasticsearch/</span><br><span class="line">#</span><br><span class="line"># Path to log files:</span><br><span class="line">#</span><br><span class="line">path.logs: /opt/homebrew/var/log/elasticsearch/</span><br><span class="line">#</span><br><span class="line"># ----------------------------------- Memory -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Lock the memory on startup:</span><br><span class="line">#</span><br><span class="line">#bootstrap.memory_lock: true</span><br><span class="line">#</span><br><span class="line"># Make sure that the heap size is set to about half the memory available</span><br><span class="line"># on the system and that the owner of the process is allowed to use this</span><br><span class="line"># limit.</span><br><span class="line">#</span><br><span class="line"># Elasticsearch performs poorly when the system is swapping the memory.</span><br><span class="line">#</span><br><span class="line"># ---------------------------------- Network -----------------------------------</span><br><span class="line">#</span><br><span class="line"># By default Elasticsearch is only accessible on localhost. Set a different</span><br><span class="line"># address here to expose this node on the network:</span><br><span class="line">#</span><br><span class="line">#network.host: 192.168.0.1</span><br><span class="line">#</span><br><span class="line"># By default Elasticsearch listens for HTTP traffic on the first free port it</span><br><span class="line"># finds starting at 9200. Set a specific HTTP port here:</span><br><span class="line">#</span><br><span class="line">#http.port: 9200</span><br><span class="line">#</span><br><span class="line"># For more information, consult the network module documentation.</span><br><span class="line">#</span><br><span class="line"># --------------------------------- Discovery ----------------------------------</span><br><span class="line">#</span><br><span class="line"># Pass an initial list of hosts to perform discovery when this node is started:</span><br><span class="line"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span><br><span class="line">#</span><br><span class="line">#discovery.seed_hosts: [&quot;host1&quot;, &quot;host2&quot;]</span><br><span class="line">#</span><br><span class="line"># Bootstrap the cluster using an initial set of master-eligible nodes:</span><br><span class="line">#</span><br><span class="line">#cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;]</span><br><span class="line">#</span><br><span class="line"># For more information, consult the discovery and cluster formation module documentation.</span><br><span class="line">#</span><br><span class="line"># ---------------------------------- Various -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Require explicit names when deleting indices:</span><br><span class="line">#</span><br><span class="line">#action.destructive_requires_name: true</span><br></pre></td></tr></table></figure>



<h2 id="Docker方式使用"><a href="#Docker方式使用" class="headerlink" title="Docker方式使用"></a>Docker方式使用</h2><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">➜  ~ docker pull elasticsearch:7.14.0</span><br><span class="line">7.14.0: Pulling from library/elasticsearch</span><br><span class="line">333cbcae3fb8: Pull complete</span><br><span class="line">0a1157305657: Pull complete</span><br><span class="line">e1ccdd9b3f22: Pull complete</span><br><span class="line">0db0e54bc8bb: Pull complete</span><br><span class="line">5f19cde676a4: Pull complete</span><br><span class="line">6157fa838241: Pull complete</span><br><span class="line">036230b4b187: Pull complete</span><br><span class="line">Digest: sha256:81c126e4eddbc5576285670cb3e23d7ef7892ee5e757d6d9ba870b6fe99f1219</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> elasticsearch:7.14.0</span><br><span class="line">docker.io/library/elasticsearch:7.14.0</span><br><span class="line"></span><br><span class="line">➜  ~ docker images</span><br><span class="line">REPOSITORY               TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">tomcat_test              1.0       66ce593a481e   18 hours ago   673MB</span><br><span class="line">tomcat                   latest    b64abfdee99c   3 days ago     668MB</span><br><span class="line">redis                    6.0       9efb4c52c5bc   3 days ago     106MB</span><br><span class="line">nginx                    latest    fc16ec0c2d91   4 days ago     134MB</span><br><span class="line">docker/getting-started   latest    720f449e5af2   3 weeks ago    27.2MB</span><br><span class="line">elasticsearch            7.14.0    d9c406333741   4 months ago   1.12GB</span><br><span class="line"></span><br><span class="line"><span class="comment"># discovery.type=single-node表示以单节点的方式启动</span></span><br><span class="line">➜  ~ docker run -d -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> elasticsear</span><br><span class="line">ch:7.14.0</span><br><span class="line">7c3d3eb5a30cbd91babb05e99ae0ecd692913136ecf98771a131fe132f76123c</span><br><span class="line"></span><br><span class="line">➜  ~ docker logs -f 7c3d3 //查看启动日志</span><br><span class="line"></span><br><span class="line">➜  ~ curl http://localhost:9200  // 查看容器内的端口</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;7c3d3eb5a30c&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;docker-cluster&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;BldDHFADQGeKHW2hD-Q_LQ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;7.14.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;docker&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;dd5a0a2acaa2045ff9624f3729fc8a6f40835aa1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2021-07-29T20:49:32.864135063Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;8.9.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为启动的时候对容器和宿主机的端口进行了映射的配置，所以在外部也能看到：</p>
<p><img src="https://raw.githubusercontent.com/binshow/img/master/20211225144041.png" alt="20211225144041"></p>
<h2 id="客户端工具Kibana"><a href="#客户端工具Kibana" class="headerlink" title="客户端工具Kibana"></a>客户端工具Kibana</h2><p>Kibana 是一个 Elastic 公司推出的一个针对 es 的分析以及数据可视化平台，可以搜索、查看存放在 es 中的数据。</p>
<p>ps：<strong>Kibana 要和es版本号一致</strong></p>
<p><strong>docker方式安装启动：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker pull kibana:7.14.0</span><br><span class="line">7.14.0: Pulling from library/kibana</span><br><span class="line">333cbcae3fb8: Already exists</span><br><span class="line">5a66da3dc0ec: Pull complete</span><br><span class="line">8d20fc6d9baa: Pull complete</span><br><span class="line">b5fb0aea6f15: Pull complete</span><br><span class="line">9dfcc3233374: Pull complete</span><br><span class="line">8264e0762143: Pull complete</span><br><span class="line">54879e69654e: Pull complete</span><br><span class="line">048858ab67fa: Pull complete</span><br><span class="line">18c899a84be8: Pull complete</span><br><span class="line">05a2f15de0f2: Pull complete</span><br><span class="line">949c578e7448: Pull complete</span><br><span class="line">a35f406ea13c: Pull complete</span><br><span class="line">02e29e73ca5f: Pull complete</span><br><span class="line">Digest: sha256:7188839aee88057c1f92aaff12d6ca4f54f5f89c1a07caedbc0247c4ec041392</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> kibana:7.14.0</span><br><span class="line">docker.io/library/kibana:7.14.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网桥</span></span><br><span class="line">➜  ~ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">ac0dee6a0cb9   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">de24154ff457   ems       bridge    <span class="built_in">local</span></span><br><span class="line">47e6f8945697   ems02     bridge    <span class="built_in">local</span></span><br><span class="line">592291e47ef8   host      host      <span class="built_in">local</span></span><br><span class="line">8e92445b9a78   none      null      <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网桥bridge的具体信息:可以看到有一个容器strange_curie 的ip地址为：172.17.0.2</span></span><br><span class="line">➜  ~ docker inspect bridge</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;ac0dee6a0cb9161cde22c8ea63a5407c48a0c4e6578c1ee2fdc796d8239c69a3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2021-12-25T06:30:26.211840417Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;172.17.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;7c3d3eb5a30cbd91babb05e99ae0ecd692913136ecf98771a131fe132f76123c&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;strange_curie&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;20a50bce40b2ef5274cc0708f5ae8d143fae8f88a5bb316cb4652b06e46e7a5c&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;172.17.0.2/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.default_bridge&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.enable_icc&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.enable_ip_masquerade&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.host_binding_ipv4&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.name&quot;</span>: <span class="string">&quot;docker0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.driver.mtu&quot;</span>: <span class="string">&quot;1500&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动kibana容器</span></span><br><span class="line">➜  ~ docker run -d -p 5601:5601 --name kibana kibana:7.14.0</span><br><span class="line">b727a8802b8246760bc5a5e565000932fddaf205aafb7ab7a223e79cec2fe016</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录kibana容器，进去修改kibana的配置文件，设置kibana要连接的es的ip地址</span></span><br><span class="line">➜  ~ docker <span class="built_in">exec</span> -it b727 bash</span><br><span class="line">bash-4.4$ <span class="built_in">cd</span> config/</span><br><span class="line">bash-4.4$ ls</span><br><span class="line">kibana.yml  node.options</span><br><span class="line">bash-4.4$ vi kibana.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default Kibana configuration for docker target</span></span><br><span class="line">server.host: <span class="string">&quot;0&quot;</span></span><br><span class="line">server.shutdownTimeout: <span class="string">&quot;5s&quot;</span></span><br><span class="line">elasticsearch.hosts: [ <span class="string">&quot;http://172.17.0.2:9200&quot;</span> ]  //修改这里的ip地址</span><br><span class="line">monitoring.ui.container.elasticsearch.enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启kibana服务</span></span><br><span class="line">➜  ~ docker restart b727a</span><br><span class="line">b727a</span><br></pre></td></tr></table></figure>

<p>现在就可以在宿主机上访问localhost:5601 和docker中的es建立连接了：</p>
<p><img src="https://raw.githubusercontent.com/binshow/img/master/20211225154002.png" alt="20211225154002"></p>
<p>使用docker中的数据卷的方式来启动kibana：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker ps</span><br><span class="line">CONTAINER ID   IMAGE                  COMMAND                  CREATED             STATUS             PORTS                                            NAMES</span><br><span class="line">b727a8802b82   kibana:7.14.0          <span class="string">&quot;/bin/tini -- /usr/l…&quot;</span>   8 minutes ago       Up 5 minutes       0.0.0.0:5601-&gt;5601/tcp                           kibana</span><br><span class="line">7c3d3eb5a30c   elasticsearch:7.14.0   <span class="string">&quot;/bin/tini -- /usr/l…&quot;</span>   About an hour ago   Up About an hour   0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp   strange_curie</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先进入容器</span></span><br><span class="line">➜  ~ docker <span class="built_in">exec</span> -it b727 bash</span><br><span class="line">bash-4.4$ <span class="built_in">cd</span> config/</span><br><span class="line">bash-4.4$ ls</span><br><span class="line">kibana.yml  node.options</span><br><span class="line">bash-4.4$ <span class="built_in">pwd</span></span><br><span class="line">/usr/share/kibana/config</span><br><span class="line">bash-4.4$ <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把容器中的kibana.yml 复制到宿主机上</span></span><br><span class="line">➜  ~ docker cp b727:/usr/share/kibana/config/kibana.yml /Users/shengbinbin/<span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对宿主机上的文件进行修改</span></span><br><span class="line">➜  ~ vim /Users/shengbinbin/<span class="built_in">test</span>/kibana.yml</span><br><span class="line"></span><br><span class="line">➜  ~ docker ps</span><br><span class="line">CONTAINER ID   IMAGE                  COMMAND                  CREATED             STATUS             PORTS                                            NAMES</span><br><span class="line">b727a8802b82   kibana:7.14.0          <span class="string">&quot;/bin/tini -- /usr/l…&quot;</span>   11 minutes ago      Up 8 minutes       0.0.0.0:5601-&gt;5601/tcp                           kibana</span><br><span class="line">7c3d3eb5a30c   elasticsearch:7.14.0   <span class="string">&quot;/bin/tini -- /usr/l…&quot;</span>   About an hour ago   Up About an hour   0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp   strange_curie</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除原来的容器</span></span><br><span class="line">➜  ~ docker rm -f b727a8802b82</span><br><span class="line">b727a8802b82</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以数据卷映射的方式来启动kibana容器</span></span><br><span class="line">➜  ~ docker run -d --name kibana -p 5601:5601 -v /Users/shengbinbin/<span class="built_in">test</span>/kibana.yml:/usr/share/kibana/config/kibana.yml kibana:7.14.0</span><br><span class="line">2733750b985647bc73714801e9cac99bbb81b4a722726e4be2f74751f1b97569</span><br></pre></td></tr></table></figure>

<p>这样的话，我们只要在宿主机上修改kibana配置文件就可以生效了！！</p>
<h2 id="ES服务和Kibana服务基于Docker组装成compose"><a href="#ES服务和Kibana服务基于Docker组装成compose" class="headerlink" title="ES服务和Kibana服务基于Docker组装成compose"></a>ES服务和Kibana服务基于Docker组装成compose</h2><p>待补充</p>
<h1 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h1><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引<index></h2><p>官方定义：<strong>一个索引就是一个拥有几分相似特征的文档的集合</strong>（类似于MySQL中的库？）</p>
<p>比如说，你可以有一个商品数据的索引，一个订单数据的索引，还有一个用户数据的索引**。一个索引由一个名字来标识(必须全部是小写字母的)**，并且当我们要对这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。</p>
<h2 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射<Mapping></h2><p><strong>映射是定义一个文档和它所包含的字段如何被存储和索引的过程</strong>。在默认配置下，ES可以根据插入的数据自动地创建mapping，也可以手动创建mapping。<strong>mapping中主要 包括字段名、字段类型等</strong></p>
<p>(类似于MySQL中的字段？)</p>
<h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档<Document></h2><p><strong>文档是索引中存储的一条条数据</strong>。一条文档是一个可被索引的最小单元。ES中的文档采用轻量级的JSON格式数据来表示。</p>
<h2 id="ElasticSearch-Vs-关系型数据库"><a href="#ElasticSearch-Vs-关系型数据库" class="headerlink" title="ElasticSearch Vs 关系型数据库"></a>ElasticSearch Vs 关系型数据库</h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYmWb3k1hyO9xNiclsZrichz6edvm33AAFXGtxSgicMJg14Vp3TINYgqn8Ayj7vR86yiawSP8ibbKviaibWsA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h1 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h1><h2 id="索引基本操作"><a href="#索引基本操作" class="headerlink" title="索引基本操作"></a>索引基本操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看es中的索引</span></span><br><span class="line">GET /_cat/indices?v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建索引</span></span><br><span class="line">PUT /products</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带设置项的创建索引</span></span><br><span class="line">PUT /orders</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;number_of_replicas&quot;</span>: 1, </span><br><span class="line">    <span class="string">&quot;number_of_shards&quot;</span>: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除索引</span></span><br><span class="line">DELETE /products</span><br></pre></td></tr></table></figure>



<h2 id="映射基本操作"><a href="#映射基本操作" class="headerlink" title="映射基本操作"></a>映射基本操作</h2><p>数据类型：</p>
<ul>
<li>字符串类型：keyword、text</li>
<li>数字类型：Integer、long</li>
<li>小数类型： float、 double</li>
<li>布尔类型：boolean</li>
<li>日期类型： date</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建索引时创建映射,映射信息是不支持修改的！！！</span></span><br><span class="line">PUT /products</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;number_of_replicas&quot;</span>: 0</span><br><span class="line">    , <span class="string">&quot;number_of_shards&quot;</span>: 1</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>:<span class="string">&quot;integer&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;title&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;price&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;double&quot;</span>  </span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;created_at&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;description&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个索引的映射信息</span></span><br><span class="line">GET /products/_mapping</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;products&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;created_at&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;date&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;description&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;id&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;integer&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;price&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;double&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;title&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="文档基本操作"><a href="#文档基本操作" class="headerlink" title="文档基本操作"></a>文档基本操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加文档，指定文档id</span></span><br><span class="line">POST /products/_doc/1 </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;id&quot;</span>:1,</span><br><span class="line">  <span class="string">&quot;title&quot;</span>:<span class="string">&quot;方便面&quot;</span>,</span><br><span class="line">  <span class="string">&quot;price&quot;</span>:0.5,</span><br><span class="line">  <span class="string">&quot;create_at&quot;</span>:<span class="string">&quot;2020-12-25&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>:<span class="string">&quot;方便面好吃！&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加文档 ， 自动生成文档id</span></span><br><span class="line">POST /products/_doc/</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>:<span class="string">&quot;卫龙&quot;</span>,</span><br><span class="line">  <span class="string">&quot;price&quot;</span>:1.5,</span><br><span class="line">  <span class="string">&quot;create_at&quot;</span>:<span class="string">&quot;2020-12-21&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>:<span class="string">&quot;卫龙好辣！&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文档查询操作</span></span><br><span class="line">GET /products/_doc/1</span><br><span class="line">GET /products/_doc/TrvP8H0BIZpKWg-IL_pN</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文档删除操作</span></span><br><span class="line">DELETE /products/_doc/1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文档更新操作：先删除原始文档，并从新添加，需要传递全部字段！</span></span><br><span class="line">PUT /products/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>:<span class="string">&quot;拌面&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文档更新操作 基于指定字段进行更新</span></span><br><span class="line">POST /products/_doc/1/_update</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;doc&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;price&quot;</span>:1.6</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文档的批量操作 _buld 代表批量操作</span></span><br><span class="line"><span class="comment"># 批量增加数据 ， 注意数据必须要在一行！</span></span><br><span class="line">POST /products/_doc/_bulk</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:2&#125;&#125;</span><br><span class="line">  &#123;<span class="string">&quot;id&quot;</span> : 2,<span class="string">&quot;title&quot;</span> : <span class="string">&quot;棒棒鸡&quot;</span>,<span class="string">&quot;price&quot;</span> : 0.8,<span class="string">&quot;create_at&quot;</span> : <span class="string">&quot;2018-12-11&quot;</span>,<span class="string">&quot;description&quot;</span> : <span class="string">&quot;棒棒鸡好吃！&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:3&#125;&#125;</span><br><span class="line">  &#123;<span class="string">&quot;id&quot;</span> : 3,<span class="string">&quot;title&quot;</span> : <span class="string">&quot;大辣片&quot;</span>,<span class="string">&quot;price&quot;</span> : 1.8,<span class="string">&quot;create_at&quot;</span> : <span class="string">&quot;2018-12-11&quot;</span>,<span class="string">&quot;description&quot;</span> : <span class="string">&quot;大辣片好吃！&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">GET /products/_doc/2</span><br><span class="line">GET /products/_doc/3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文档的批量操作 有添加、更新、删除</span></span><br><span class="line"><span class="comment"># 注意不是原子性的操作，其中如果由操作失败了，另外的操作也可能会成功！</span></span><br><span class="line">POST /products/_doc/_bulk</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:4&#125;&#125;</span><br><span class="line">  &#123;<span class="string">&quot;id&quot;</span> : 2,<span class="string">&quot;title&quot;</span> : <span class="string">&quot;鱼豆腐&quot;</span>,<span class="string">&quot;price&quot;</span> : 0.8,<span class="string">&quot;create_at&quot;</span> : <span class="string">&quot;2018-12-11&quot;</span>,<span class="string">&quot;description&quot;</span> : <span class="string">&quot;鱼豆腐好吃！&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;update&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:3&#125;&#125;</span><br><span class="line">  &#123;<span class="string">&quot;doc&quot;</span>:&#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;棒棒鸡1&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;delete&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:2&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="高级查询"><a href="#高级查询" class="headerlink" title="高级查询"></a>高级查询</h1><p>利用restful API查询</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># query DSL 语法, 查询所有 match_all</span></span><br><span class="line">GET /products/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>:&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以不写_doc</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>:&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基于关键词查询 term ： </span></span><br><span class="line"><span class="comment"># keyword 、integer 、double 、date 需要使用全部内容搜索,不分词</span></span><br><span class="line"><span class="comment"># 1. text 类型字段默认使用es标准分词器：中文单字分词 ， 英文单词分词</span></span><br><span class="line"><span class="comment"># 2. 只有text类型分词，其余的类型都不分词</span></span><br><span class="line">GET /products/_mapping</span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;鱼豆腐&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;description&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;辣&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 范围查询 range , gte 大于等于 , lte 小于等于</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;gte&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;lte&quot;</span>: 5</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 前缀查询  prefix</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;prefix&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;棒棒&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通配符查询 wildcard:  ?匹配一个任意字符，*匹配多个字符</span></span><br><span class="line"><span class="comment"># 文档更新操作 基于指定字段进行更新</span></span><br><span class="line">POST /products/_doc/1/_update</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;doc&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;description&quot;</span>:<span class="string">&quot;good&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /products/_doc/1</span><br><span class="line"></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;wildcard&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;description&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;g*&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询一组符合条件的id</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;ids&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;values&quot;</span>: [1,2,3]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模糊查询 fuzzy ， 注意最大模糊错误必须在 0 ~ 2 之间</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;fuzzy&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;小鱼豆腐&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 布尔查询 ： 用于组合多个条件实现复杂查询</span></span><br><span class="line"><span class="comment"># must 就是且 ， should 就是 或 ， must_not</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;must&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;ids&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;values&quot;</span>: [1]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">          <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: &#123;</span><br><span class="line">              <span class="string">&quot;value&quot;</span>: <span class="string">&quot;方便面&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多字段查询 multi_match : 一个值在多个字段查询</span></span><br><span class="line"><span class="comment"># query 输入关键词，输入一段文本，会根据字段的类型来查询这个值，如果该字段不分词就按整体查询</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;方便面&quot;</span>,</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [<span class="string">&quot;title&quot;</span> , <span class="string">&quot;description&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#默认字段分词查询 : query_string</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;default_field&quot;</span>: <span class="string">&quot;description&quot;</span>,</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;鱼豆腐好吃&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 高亮查询 , 高亮的字段必须要能分词</span></span><br><span class="line">GET /products/_mapping</span><br><span class="line"></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;default_field&quot;</span>: <span class="string">&quot;description&quot;</span>,</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;鱼豆腐好吃&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;highlight&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;pre_tags&quot;</span>: [<span class="string">&quot;&lt;span style=&#x27;color:red;&#x27;&gt;&quot;</span>],</span><br><span class="line">    <span class="string">&quot;post_tags&quot;</span>: [<span class="string">&quot;&lt;/span&gt;&quot;</span>],</span><br><span class="line">    <span class="string">&quot;require_field_match&quot;</span>: <span class="string">&quot;false&quot;</span>, </span><br><span class="line">    <span class="string">&quot;fields&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;*&quot;</span>:&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回指定条数 size , 默认是10条</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页查询 form ： 用于指定起始位置</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;from&quot;</span>: 1, </span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果排序 sort , 文档就没有得分了</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 5,</span><br><span class="line">  <span class="string">&quot;sort&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;order&quot;</span>: <span class="string">&quot;desc&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回指定字段 ： _source</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 5,</span><br><span class="line">  <span class="string">&quot;sort&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;order&quot;</span>: <span class="string">&quot;desc&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;_source&quot;</span>: [<span class="string">&quot;id&quot;</span>,<span class="string">&quot;price&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="索引原理"><a href="#索引原理" class="headerlink" title="索引原理"></a>索引原理</h1><h2 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h2><p><strong>倒排索引(Inverted Index)</strong> 的意思是根据value 找对应的key。ES底层在检索时底层使用的就是倒排索引。</p>
<p>举例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">DELETE /products</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立索引</span></span><br><span class="line">PUT /products</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;description&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;price&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;float&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;title&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量插入文档</span></span><br><span class="line">PUT /products/_doc/_bulk</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:1&#125;&#125;</span><br><span class="line">  &#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;蓝月亮洗衣液&quot;</span>, <span class="string">&quot;price&quot;</span>:19.9 , <span class="string">&quot;description&quot;</span>:<span class="string">&quot;蓝月亮洗衣液很高效&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:2&#125;&#125;</span><br><span class="line">  &#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;iphone13&quot;</span>, <span class="string">&quot;price&quot;</span>:19.9 , <span class="string">&quot;description&quot;</span>:<span class="string">&quot;很不错的手机&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:3&#125;&#125;</span><br><span class="line">  &#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;小浣熊干脆面&quot;</span>, <span class="string">&quot;price&quot;</span>:9.9 , <span class="string">&quot;description&quot;</span>:<span class="string">&quot;小浣熊很好吃&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>es在底层是如何存储这三条数据的呢？</p>
<ul>
<li><p>元数据区： <strong>一次存放着三条文档的完整记录</strong></p>
</li>
<li><p>索引区：根据不同的字段来存放的v-k</p>
<ul>
<li><p>title字段：keyword类型，不分词</p>
</li>
<li><table>
<thead>
<tr>
<th>term</th>
<th>_id(文档id)</th>
</tr>
</thead>
<tbody><tr>
<td>蓝月亮洗衣液</td>
<td>1</td>
</tr>
<tr>
<td>iphone13</td>
<td>2</td>
</tr>
<tr>
<td>小浣熊干脆面</td>
<td>3</td>
</tr>
</tbody></table>
<p>price字段：不分词</p>
<table>
<thead>
<tr>
<th>term</th>
<th>_id(文档id)</th>
</tr>
</thead>
<tbody><tr>
<td>19.9</td>
<td>[1,2]</td>
</tr>
<tr>
<td>1.5</td>
<td>3</td>
</tr>
</tbody></table>
</li>
<li><p>description字段：类型为text，默认拆分成单个字来分词</p>
<table>
<thead>
<tr>
<th align="left">term</th>
<th>_id</th>
<th>Term</th>
<th>_id</th>
<th>term</th>
<th>_id</th>
</tr>
</thead>
<tbody><tr>
<td align="left">蓝</td>
<td>1</td>
<td>不</td>
<td>2</td>
<td>小</td>
<td></td>
</tr>
<tr>
<td align="left">月</td>
<td>1</td>
<td>错</td>
<td>2</td>
<td>浣</td>
<td></td>
</tr>
<tr>
<td align="left">亮</td>
<td>1</td>
<td>的</td>
<td>2</td>
<td>熊</td>
<td></td>
</tr>
<tr>
<td align="left">洗</td>
<td>1</td>
<td>手</td>
<td>2</td>
<td>好</td>
<td></td>
</tr>
<tr>
<td align="left">衣</td>
<td>1</td>
<td>机</td>
<td>2</td>
<td>吃</td>
<td></td>
</tr>
<tr>
<td align="left">液</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td align="left"><strong>很</strong></td>
<td><strong>【1：1：9，2：1：6，3：1：6】</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td align="left">高</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td align="left">效</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
</ul>
</li>
<li><p>1：1：9 表示文档id=1 ， 出现了1次，这个字段总共有9个字</p>
</li>
</ul>
<p>所以排序返回的时候得分顺序就决定了，是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;description&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;很&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#! Elasticsearch built-in security features are not enabled. Without authentication, your cluster could be accessible to anyone. See https:<span class="comment">//www.elastic.co/guide/en/elasticsearch/reference/7.14/security-minimal-setup.html to enable security.</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;took&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;value&quot;</span> : <span class="number">3</span>,</span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> : <span class="number">0.14181954</span>,</span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;products&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="number">0.14181954</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;title&quot;</span> : <span class="string">&quot;iphone13&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;price&quot;</span> : <span class="number">19.9</span>,</span><br><span class="line">          <span class="attr">&quot;description&quot;</span> : <span class="string">&quot;很不错的手机&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;products&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="number">0.14181954</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;title&quot;</span> : <span class="string">&quot;小浣熊干脆面&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;price&quot;</span> : <span class="number">9.9</span>,</span><br><span class="line">          <span class="attr">&quot;description&quot;</span> : <span class="string">&quot;小浣熊很好吃&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;products&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="number">0.11955717</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;title&quot;</span> : <span class="string">&quot;蓝月亮洗衣液&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;price&quot;</span> : <span class="number">19.9</span>,</span><br><span class="line">          <span class="attr">&quot;description&quot;</span> : <span class="string">&quot;蓝月亮洗衣液很高效&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>









<h1 id="分词器"><a href="#分词器" class="headerlink" title="分词器"></a>分词器</h1><p><strong>文本分析的意思就是将全文本转换成一系列的单词（term/token）的过程，也称为分词。</strong></p>
<p>ElasticSearch 核心功能就是数据检索，首先通过索引将文档写入 es。查询分析则主要分为两个步骤：</p>
<ol>
<li>词条化：<strong>分词器</strong>将输入的文本转为一个一个的词条流。</li>
<li>过滤：比如停用词过滤器会从词条中去除不相干的词条（的，嗯，啊，呢）；另外还有同义词过滤器、小写过滤器等。</li>
</ol>
<h2 id="分词器的组成"><a href="#分词器的组成" class="headerlink" title="分词器的组成"></a>分词器的组成</h2><p>由下面三个部分组成：</p>
<ul>
<li><strong>Character filter</strong> 字符过滤器：再在一段文本进行分词之前，先进行预处理，比如说最常见的就是，过滤hIml标签(<span>hello<span> –&gt; hello)等</li>
<li>**tokenizers **分词器：英文分词可以根据空格将单词分开,中文分词比较复杂，可以采用机器学习算法来分词。</li>
<li><strong>Token filter</strong> Token过滤器：将切分的单词进行加工。大小写转换(例将“Quick”转为小写)，去掉停用词 (例如<br>停用词像“a”、“and”、 “the”等等)，加入同义词 (例如同义词像“jump”和”leap”)。</li>
</ul>
<blockquote>
<p>注意:</p>
<ul>
<li>三者顺序: Character Filters–&gt;Tokenizer–&gt;Token Filter</li>
<li>三者个数: Character Filters (0个或多个) + Tokenizer + Token Filters(0个或多个)</li>
</ul>
</blockquote>
<h2 id="内置分词器"><a href="#内置分词器" class="headerlink" title="内置分词器"></a>内置分词器</h2><p>ElasticSearch 中内置了多种分词器可以供使用,默认使用的是表标准分词器</p>
<p>内置分词器：</p>
<p><img src="https://raw.githubusercontent.com/binshow/img/master/20211225220409.png" alt="20211225220409"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分词器测试</span></span><br><span class="line">POST /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>:<span class="string">&quot;我是中国人, this is a good conuntry&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;simple&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>:<span class="string">&quot;我是中国人, this is a good conuntry&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;whitespace&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>:<span class="string">&quot;我是中国人, this is a good conuntry&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;stop&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>:<span class="string">&quot;我是中国人, this is a good conuntry&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>:<span class="string">&quot;我是中国人, this is a good conuntry&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;pattern&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>:<span class="string">&quot;我是中国人, this is a good conuntry&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建索引时指定分词器：</span></span><br><span class="line">PUT /testabc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;title&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="中文分词器"><a href="#中文分词器" class="headerlink" title="中文分词器"></a>中文分词器</h2><p>在 Es 中，使用较多的中文分词器是 elasticsearch-analysis-ik，这个是 es 的一个第三方插件，代码托管在 GitHub 上：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></li>
</ul>
<p>ps: <strong>ik分词器要和es版本一致！！！</strong></p>
<h4 id="4-2-3-自定义扩展词库"><a href="#4-2-3-自定义扩展词库" class="headerlink" title="4.2.3 自定义扩展词库"></a>4.2.3 自定义扩展词库</h4><h5 id="4-2-3-1-本地自定义"><a href="#4-2-3-1-本地自定义" class="headerlink" title="4.2.3.1 本地自定义"></a>4.2.3.1 本地自定义</h5><p>在 es/plugins/ik/config 目录下，新建 ext.dic 文件（文件名任意），在该文件中可以配置自定义的词库。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPRAwJqk6MmZ2tCIIcLINdXw2WtU2Cla03qoibD4V16VmeSjAMVv1HVvw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>如果有多个词，换行写入新词即可。</p>
<p>然后在 es/plugins/ik/config/IKAnalyzer.cfg.xml 中配置扩展词典的位置：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPPCzgzYG9Nm8Y0B9WaqldVYyRSvXyqcLdyiaibv4cT0YCYlDn5iaz59mNA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h5 id="4-2-3-2-远程词库"><a href="#4-2-3-2-远程词库" class="headerlink" title="4.2.3.2 远程词库"></a>4.2.3.2 远程词库</h5><p>也可以配置远程词库，远程词库支持热更新（不用重启 es 就可以生效）。</p>
<p>热更新只需要提供一个接口，接口返回扩展词即可。</p>
<p>具体使用方式如下，新建一个 Spring Boot 项目，引入 Web 依赖即可。然后在 resources/stastic 目录下新建 ext.dic 文件，写入扩展词：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPH3d1z49Rg9hsvxfjXgErBStFdF61cCo3aA430udggtgUJCaGQyiamLg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>接下来，在 es/plugins/ik/config/IKAnalyzer.cfg.xml 文件中配置远程扩展词接口：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPhCTFQHzM9wBAib8TCR3FWiasNrkgFlVvoCuKaqHziaibf5pIicUx2Q5vicWg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>配置完成后，重启 es ，即可生效。</p>
<p>热更新，主要是响应头的 <code>Last-Modified</code> 或者 <code>ETag</code> 字段发生变化，ik 就会自动重新加载远程扩展</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>ElasticSearch从入门到实战</p><p><a href="http://example.com/2021/06/29/ElasticSearch从入门到实战/">http://example.com/2021/06/29/ElasticSearch从入门到实战/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>binshow</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-06-29</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-12-25</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/ElasticSearch/">ElasticSearch</a></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/" alt="支付宝"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/06/30/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%89%EF%BC%89%E8%A7%84%E8%8C%83%E5%92%8C%E9%87%8D%E6%9E%84%E5%AE%9E%E6%88%98/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">设计模式（三）规范和重构实战</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/06/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%BA%8C%EF%BC%89%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/"><span class="level-item">设计模式（二）设计原则</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="binshow"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">binshow</p><p class="is-size-6 is-block">后台开发工程师</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>安徽</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">108</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">1</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">21</p></a></div></div></nav></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#ElasticSearch简介"><span class="level-left"><span class="level-item">1</span><span class="level-item">ElasticSearch简介</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#全文索引"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">全文索引</span></span></a></li><li><a class="level is-mobile" href="#Lucene"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">Lucene</span></span></a></li><li><a class="level is-mobile" href="#ElasticSearch"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">ElasticSearch</span></span></a></li></ul></li><li><a class="level is-mobile" href="#安装"><span class="level-left"><span class="level-item">2</span><span class="level-item">安装</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Docker方式使用"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Docker方式使用</span></span></a></li><li><a class="level is-mobile" href="#客户端工具Kibana"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">客户端工具Kibana</span></span></a></li><li><a class="level is-mobile" href="#ES服务和Kibana服务基于Docker组装成compose"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">ES服务和Kibana服务基于Docker组装成compose</span></span></a></li></ul></li><li><a class="level is-mobile" href="#核心概念"><span class="level-left"><span class="level-item">3</span><span class="level-item">核心概念</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#索引"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">索引</span></span></a></li><li><a class="level is-mobile" href="#映射"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">映射</span></span></a></li><li><a class="level is-mobile" href="#文档"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">文档</span></span></a></li><li><a class="level is-mobile" href="#ElasticSearch-Vs-关系型数据库"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">ElasticSearch Vs 关系型数据库</span></span></a></li></ul></li><li><a class="level is-mobile" href="#基本操作"><span class="level-left"><span class="level-item">4</span><span class="level-item">基本操作</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#索引基本操作"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">索引基本操作</span></span></a></li><li><a class="level is-mobile" href="#映射基本操作"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">映射基本操作</span></span></a></li><li><a class="level is-mobile" href="#文档基本操作"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">文档基本操作</span></span></a></li></ul></li><li><a class="level is-mobile" href="#高级查询"><span class="level-left"><span class="level-item">5</span><span class="level-item">高级查询</span></span></a></li><li><a class="level is-mobile" href="#索引原理"><span class="level-left"><span class="level-item">6</span><span class="level-item">索引原理</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#倒排索引"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">倒排索引</span></span></a></li></ul></li><li><a class="level is-mobile" href="#分词器"><span class="level-left"><span class="level-item">7</span><span class="level-item">分词器</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#分词器的组成"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">分词器的组成</span></span></a></li><li><a class="level is-mobile" href="#内置分词器"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">内置分词器</span></span></a></li><li><a class="level is-mobile" href="#中文分词器"><span class="level-left"><span class="level-item">7.3</span><span class="level-item">中文分词器</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#4-2-3-2-远程词库"><span class="level-left"><span class="level-item">7.3.1.1</span><span class="level-item">4.2.3.2 远程词库</span></span></a></li></ul></ul></li></ul></li></ul></div></div><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">技术</span></span><span class="level-end"><span class="level-item tag">92</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-09T15:07:17.000Z">2022-01-09</time></p><p class="title"><a href="/2022/01/09/Go-%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%8E%86%E5%8F%B2%E5%92%8C%E5%8F%91%E5%B1%95/">Go_协程的历史和发展</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-08T13:06:43.000Z">2022-01-08</time></p><p class="title"><a href="/2022/01/08/CSAPP%EF%BC%88%E5%9B%9B%EF%BC%89%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/">CSAPP（四）虚拟内存</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-06T15:25:41.000Z">2022-01-06</time></p><p class="title"><a href="/2022/01/06/CSAPP%EF%BC%88%E4%B8%89%EF%BC%89%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/">CSAPP（三）存储结构</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-06T15:25:30.000Z">2022-01-06</time></p><p class="title"><a href="/2022/01/06/CSAPP%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BF%A1%E6%81%AF%E8%A1%A8%E7%A4%BA/">CSAPP（二）信息表示</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-06T15:25:21.000Z">2022-01-06</time></p><p class="title"><a href="/2022/01/06/CSAPP%EF%BC%88%E4%B8%80%EF%BC%89%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8/">CSAPP（一）系统漫游</a></p></div></article></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="漫漫转码路" height="28"></a><p class="is-size-7"><span>&copy; 2022 binshow</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>