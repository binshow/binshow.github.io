<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ElasticSearch从入门到实战 - 漫漫转码路</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="漫漫转码路"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="漫漫转码路"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="本篇主要讲述了elasticsearch入门的一些基本概念（来源：江南一点雨）  简介 安装 十大核心概念 分词器 索引基本操作 文档基本操作 版本控制 倒排索引"><meta property="og:type" content="blog"><meta property="og:title" content="ElasticSearch从入门到实战"><meta property="og:url" content="http://example.com/2021/06/29/ElasticSearch%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/"><meta property="og:site_name" content="漫漫转码路"><meta property="og:description" content="本篇主要讲述了elasticsearch入门的一些基本概念（来源：江南一点雨）  简介 安装 十大核心概念 分词器 索引基本操作 文档基本操作 版本控制 倒排索引"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/gallery/covers/elasticsearch.jpeg"><meta property="article:published_time" content="2021-06-29T10:26:25.000Z"><meta property="article:modified_time" content="2021-07-01T10:05:10.446Z"><meta property="article:author" content="binshow"><meta property="article:tag" content="ElasticSearch"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/gallery/covers/elasticsearch.jpeg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2021/06/29/ElasticSearch%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/"},"headline":"ElasticSearch从入门到实战","image":[],"datePublished":"2021-06-29T10:26:25.000Z","dateModified":"2021-07-01T10:05:10.446Z","author":{"@type":"Person","name":"binshow"},"description":"本篇主要讲述了elasticsearch入门的一些基本概念（来源：江南一点雨）  简介 安装 十大核心概念 分词器 索引基本操作 文档基本操作 版本控制 倒排索引"}</script><link rel="canonical" href="http://example.com/2021/06/29/ElasticSearch%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="漫漫转码路" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/gallery/covers/elasticsearch.jpeg" alt="ElasticSearch从入门到实战"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-06-29T10:26:25.000Z" title="2021/6/29下午6:26:25">2021-06-29</time>发表</span><span class="level-item"><time dateTime="2021-07-01T10:05:10.446Z" title="2021/7/1下午6:05:10">2021-07-01</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span><span class="level-item">1 小时读完 (大约6942个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">ElasticSearch从入门到实战</h1><div class="content"><p>本篇主要讲述了elasticsearch入门的一些基本概念（来源：江南一点雨）</p>
<ul>
<li>简介</li>
<li>安装</li>
<li>十大核心概念</li>
<li>分词器</li>
<li>索引基本操作</li>
<li>文档基本操作</li>
<li>版本控制</li>
<li>倒排索引</li>
</ul>
<span id="more"></span>

<h1 id="ElasticSearch简介"><a href="#ElasticSearch简介" class="headerlink" title="ElasticSearch简介"></a>ElasticSearch简介</h1><h2 id="Lucene"><a href="#Lucene" class="headerlink" title="Lucene"></a>Lucene</h2><p>Lucene 是一个开源、免费、高性能、纯 Java 编写的全文检索引擎，可以算作是开源领域最好的全文检索工具包。</p>
<p>在实际开发中，Lucene 几乎适用于任何需要全文检索的场景，所以 Lucene 先后发展出好多语言版本，例如 C++、C#、Python 等。</p>
<p>早在 2005 年，Lucene 就升级为 Apache 顶级开源项目。它的作者是 Doug Cutting，有的人可能没听过这这个人，不过你肯定听过他的另一个大名鼎鼎的作品 Hadoop。</p>
<p>不过需要注意的是，Lucene 只是一个工具包，并非一个完整的搜索引擎，开发者可以基于 Lucene 来开发完整的搜索引擎。比较著名的有 Solr、ElasticSearch，不过在分布式和大数据环境下，ElasticSearch 更胜一筹。</p>
<p>Lucene 主要有如下特点：</p>
<ul>
<li>简单</li>
<li>跨语言</li>
<li>强大的搜索引擎</li>
<li>索引速度快</li>
<li>索引文件兼容不同平台</li>
</ul>
<h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><p>ElasticSearch 是一个分布式、可扩展、近实时性的高性能搜索与数据分析引擎。ElasticSearch 基于 Java 编写，通过进一步封装 Lucene，将搜索的复杂性屏蔽起来，开发者只需要一套简单的 RESTful API 就可以操作全文检索。</p>
<p>ElasticSearch 在分布式环境下表现优异，这也是它比较受欢迎的原因之一。它支持 PB 级别的结构化或非结构化海量数据处理</p>
<p>整体上来说，ElasticSearch 有三大功能：</p>
<ul>
<li>数据搜集</li>
<li>数据分析</li>
<li>数据存储</li>
</ul>
<p>ElasticSearch 的主要特点：</p>
<ol>
<li>分布式文件存储。</li>
<li>实时分析的分布式搜索引擎。</li>
<li>高可拓展性。</li>
<li>可插拔的插件支持。</li>
</ol>
<h1 id="ElasticSearch安装（homebrew）"><a href="#ElasticSearch安装（homebrew）" class="headerlink" title="ElasticSearch安装（homebrew）"></a>ElasticSearch安装（homebrew）</h1><p>首先打开 Es 官网，找到 Elasticsearch：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/elasticsearch/">https://www.elastic.co/cn/elasticsearch/</a></li>
<li>点击 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.13/brew.html%EF%BC%8C%E6%8C%89%E7%85%A7%E6%8F%90%E7%A4%BA%E5%AE%89%E8%A3%85">https://www.elastic.co/guide/en/elasticsearch/reference/7.13/brew.html，按照提示安装</a></li>
<li>打开终端</li>
</ul>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">shengbinbin@192 ~ % brew list   //查看所有homebrew安装的软件</span><br><span class="line">==&gt; Formulae</span><br><span class="line">autoconf		icu4c			maven			pkg-config</span><br><span class="line">brotli			jemalloc		mysql			protobuf</span><br><span class="line">c-ares			kibana-full		nghttp2			redis</span><br><span class="line">elasticsearch-full	libev			node			tcl-tk</span><br><span class="line">freetype		libpng			openjdk</span><br><span class="line">git-gui			libuv			openjdk@11</span><br><span class="line">gradle			m4			openssl@1.1</span><br><span class="line"></span><br><span class="line">shengbinbin@192 ~ % brew info elasticsearch-full  //查看安装的elasticsearch-full详细信息</span><br><span class="line">elastic/tap/elasticsearch-full: stable 7.13.2</span><br><span class="line">Distributed search &amp; analytics engine</span><br><span class="line">https://www.elastic.co/products/elasticsearch</span><br><span class="line">Conflicts with:</span><br><span class="line">  elasticsearch</span><br><span class="line">/opt/homebrew/Cellar/elasticsearch-full/7.13.2 (957 files, 504.8MB) *</span><br><span class="line">  Built from <span class="built_in">source</span> on 2021-06-29 at 20:46:00</span><br><span class="line">From: https://github.com/elastic/homebrew-tap/blob/HEAD/Formula/elasticsearch-full.rb</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Data:    /opt/homebrew/var/lib/elasticsearch/elasticsearch_shengbinbin/</span><br><span class="line">Logs:    /opt/homebrew/var/<span class="built_in">log</span>/elasticsearch/elasticsearch_shengbinbin.log</span><br><span class="line">Plugins: /opt/homebrew/var/elasticsearch/plugins/</span><br><span class="line">Config:  /opt/homebrew/etc/elasticsearch/</span><br><span class="line"></span><br><span class="line">To have launchd start elastic/tap/elasticsearch-full now and restart at login:</span><br><span class="line">  brew services start elastic/tap/elasticsearch-full</span><br><span class="line">Or, <span class="keyword">if</span> you don<span class="string">&#x27;t want/need a background service you can just run:</span></span><br><span class="line"><span class="string">  elasticsearch</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>



<p>目录含义如下：</p>
<table>
<thead>
<tr>
<th align="left">目录</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">modules</td>
<td align="left">依赖模块目录</td>
</tr>
<tr>
<td align="left">lib</td>
<td align="left">第三方依赖库</td>
</tr>
<tr>
<td align="left">logs</td>
<td align="left">输出日志目录</td>
</tr>
<tr>
<td align="left">plugins</td>
<td align="left">插件目录</td>
</tr>
<tr>
<td align="left">bin</td>
<td align="left">可执行文件目录</td>
</tr>
<tr>
<td align="left">config</td>
<td align="left">配置文件目录</td>
</tr>
<tr>
<td align="left">data</td>
<td align="left">数据存储目录</td>
</tr>
</tbody></table>
<p>启动方式：打开终端，直接输入elasticsearch即可启动。看到 started 表示启动成功。</p>
<p>默认监听的端口是 9200，所以浏览器直接输入 localhost:9200 可以查看节点信息。</p>
<p><img src="https://i.loli.net/2021/06/29/mEyj5dXWpu32bga.png"></p>
<p>节点的名字以及集群（默认是 elasticsearch）的名字，我们都可以自定义配置。</p>
<p>打开 config/elasticsearch.yml 文件，可以配置集群名称以及节点名称。配置文件内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"># ======================== Elasticsearch Configuration =========================</span><br><span class="line">#</span><br><span class="line"># NOTE: Elasticsearch comes with reasonable defaults for most settings.</span><br><span class="line">#       Before you set out to tweak and tune the configuration, make sure you</span><br><span class="line">#       understand what are you trying to accomplish and the consequences.</span><br><span class="line">#</span><br><span class="line"># The primary way of configuring a node is via this file. This template lists</span><br><span class="line"># the most important settings you may want to configure for a production cluster.</span><br><span class="line">#</span><br><span class="line"># Please consult the documentation for further information on configuration options:</span><br><span class="line"># https://www.elastic.co/guide/en/elasticsearch/reference/index.html</span><br><span class="line">#</span><br><span class="line"># ---------------------------------- Cluster -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Use a descriptive name for your cluster:</span><br><span class="line">#</span><br><span class="line">cluster.name: elasticsearch_shengbinbin   //可以在这里修改集群名称</span><br><span class="line">#</span><br><span class="line"># ------------------------------------ Node ------------------------------------</span><br><span class="line">#</span><br><span class="line"># Use a descriptive name for the node:</span><br><span class="line">#</span><br><span class="line">#node.name: node-1</span><br><span class="line">#</span><br><span class="line"># Add custom attributes to the node:</span><br><span class="line">#</span><br><span class="line">#node.attr.rack: r1</span><br><span class="line">#</span><br><span class="line"># ----------------------------------- Paths ------------------------------------</span><br><span class="line">#</span><br><span class="line"># Path to directory where to store the data (separate multiple locations by comma):</span><br><span class="line">#</span><br><span class="line">path.data: /opt/homebrew/var/lib/elasticsearch/</span><br><span class="line">#</span><br><span class="line"># Path to log files:</span><br><span class="line">#</span><br><span class="line">path.logs: /opt/homebrew/var/log/elasticsearch/</span><br><span class="line">#</span><br><span class="line"># ----------------------------------- Memory -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Lock the memory on startup:</span><br><span class="line">#</span><br><span class="line">#bootstrap.memory_lock: true</span><br><span class="line">#</span><br><span class="line"># Make sure that the heap size is set to about half the memory available</span><br><span class="line"># on the system and that the owner of the process is allowed to use this</span><br><span class="line"># limit.</span><br><span class="line">#</span><br><span class="line"># Elasticsearch performs poorly when the system is swapping the memory.</span><br><span class="line">#</span><br><span class="line"># ---------------------------------- Network -----------------------------------</span><br><span class="line">#</span><br><span class="line"># By default Elasticsearch is only accessible on localhost. Set a different</span><br><span class="line"># address here to expose this node on the network:</span><br><span class="line">#</span><br><span class="line">#network.host: 192.168.0.1</span><br><span class="line">#</span><br><span class="line"># By default Elasticsearch listens for HTTP traffic on the first free port it</span><br><span class="line"># finds starting at 9200. Set a specific HTTP port here:</span><br><span class="line">#</span><br><span class="line">#http.port: 9200</span><br><span class="line">#</span><br><span class="line"># For more information, consult the network module documentation.</span><br><span class="line">#</span><br><span class="line"># --------------------------------- Discovery ----------------------------------</span><br><span class="line">#</span><br><span class="line"># Pass an initial list of hosts to perform discovery when this node is started:</span><br><span class="line"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span><br><span class="line">#</span><br><span class="line">#discovery.seed_hosts: [&quot;host1&quot;, &quot;host2&quot;]</span><br><span class="line">#</span><br><span class="line"># Bootstrap the cluster using an initial set of master-eligible nodes:</span><br><span class="line">#</span><br><span class="line">#cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;]</span><br><span class="line">#</span><br><span class="line"># For more information, consult the discovery and cluster formation module documentation.</span><br><span class="line">#</span><br><span class="line"># ---------------------------------- Various -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Require explicit names when deleting indices:</span><br><span class="line">#</span><br><span class="line">#action.destructive_requires_name: true</span><br></pre></td></tr></table></figure>



<h2 id="HEAD-插件安装"><a href="#HEAD-插件安装" class="headerlink" title="HEAD 插件安装"></a>HEAD 插件安装</h2><p>Elasticsearch-head 插件，可以通过可视化的方式查看集群信息。</p>
<p><strong>Chrome 直接在 App Store 搜索 Elasticsearch-head，点击安装即可。</strong></p>
<h3 id="2-3-分布式安装"><a href="#2-3-分布式安装" class="headerlink" title="2.3 分布式安装"></a>2.3 分布式安装</h3><p>假设：</p>
<ul>
<li>一主二从</li>
<li>master 的端口是 9200，slave 端口分别是 9201 和 9202</li>
</ul>
<p>首先修改 master 的 config/elasticsearch.yml 配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node.master: true</span><br><span class="line">network.host: 127.0.0.1</span><br></pre></td></tr></table></figure>

<p>配置完成后，重启 master。</p>
<p>将 es 的压缩包解压两份，分别命名为 slave01 和 slave02，代表两个从机。</p>
<p>分别对其进行配置。</p>
<p>slave01/config/elasticsearch.yml：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 集群名称必须保持一致</span><br><span class="line">cluster.name: javaboy-es</span><br><span class="line">node.name: slave01</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line">http.port: 9201</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1&quot;]</span><br></pre></td></tr></table></figure>

<p>slave02/config/elasticsearch.yml：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 集群名称必须保持一致</span><br><span class="line">cluster.name: javaboy-es</span><br><span class="line">node.name: slave02</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line">http.port: 9202</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1&quot;]</span><br></pre></td></tr></table></figure>

<p>然后分别启动 slave01 和 slave02。启动后，可以在 head 插件上查看集群信息。</p>
<p><img src="https://i.loli.net/2021/06/30/RApghDPY3qwxzHU.png" alt="图片"></p>
<h2 id="Kibana-安装"><a href="#Kibana-安装" class="headerlink" title="Kibana 安装"></a>Kibana 安装</h2><p>Kibana 是一个 Elastic 公司推出的一个针对 es 的分析以及数据可视化平台，可以搜索、查看存放在 es 中的数据。</p>
<ul>
<li>下载 Kibana：<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/kibana">https://www.elastic.co/cn/downloads/kibana</a></li>
<li>使用homebrew安装：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/kibana/7.13/brew.html">https://www.elastic.co/guide/en/kibana/7.13/brew.html</a></li>
<li>终端输入kibana启动</li>
<li>localhost:5601 查看默认窗口</li>
</ul>
<p><img src="https://i.loli.net/2021/06/29/87BmAORaVbdxIi2.png"></p>
<h1 id="ElasticSearch-十大核心概念"><a href="#ElasticSearch-十大核心概念" class="headerlink" title="ElasticSearch 十大核心概念"></a>ElasticSearch 十大核心概念</h1><h4 id="3-1-1-集群（Cluster）"><a href="#3-1-1-集群（Cluster）" class="headerlink" title="3.1.1 集群（Cluster）"></a>3.1.1 集群（Cluster）</h4><p>一个或者多个安装了 es 节点的服务器组织在一起，就是集群，这些节点共同持有数据，共同提供搜索服务。</p>
<p>一个集群有一个名字，这个名字是集群的唯一标识，该名字成为 cluster name，默认的集群名称是 elasticsearch，具有相同名称的节点才会组成一个集群。</p>
<p>可以在 config/elasticsearch.yml 文件中配置集群名称：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: javaboy-es</span><br></pre></td></tr></table></figure>

<p>在集群中，节点的状态有三种：绿色、黄色、红色：</p>
<ul>
<li>绿色：节点运行状态为健康状态。所有的主分片、副本分片都可以正常工作。</li>
<li>黄色：表示节点的运行状态为警告状态，所有的主分片目前都可以直接运行，但是至少有一个副本分片是不能正常工作的。</li>
<li>红色：表示集群无法正常工作。</li>
</ul>
<h4 id="3-1-2-节点（Node）"><a href="#3-1-2-节点（Node）" class="headerlink" title="3.1.2 节点（Node）"></a>3.1.2 节点（Node）</h4><p>集群中的一个服务器就是一个节点，节点中会存储数据，同时参与集群的索引以及搜索功能。一个节点想要加入一个集群，只需要配置一下集群名称即可。默认情况下，如果我们启动了多个节点，多个节点还能够互相发现彼此，那么它们会自动组成一个集群，这是 es 默认提供的，但是这种方式并不可靠，有可能会发生脑裂现象。所以在实际使用中，建议一定手动配置一下集群信息。</p>
<h4 id="3-1-3-索引（Index）"><a href="#3-1-3-索引（Index）" class="headerlink" title="3.1.3 索引（Index）"></a>3.1.3 索引（Index）</h4><p>索引可以从两方面来理解：</p>
<p><strong>名词</strong></p>
<p>具有相似特征文档的集合。</p>
<p><strong>动词</strong></p>
<p>索引数据以及对数据进行索引操作。</p>
<h4 id="3-1-4-类型（Type）"><a href="#3-1-4-类型（Type）" class="headerlink" title="3.1.4 类型（Type）"></a>3.1.4 类型（Type）</h4><p>类型是索引上的逻辑分类或者分区。在 es6 之前，一个索引中可以有多个类型，从 es7 开始，一个索引中，只能有一个类型。在 es6.x 中，依然保持了兼容，依然支持单 index 多个 type 结构，但是已经不建议这么使用。</p>
<h4 id="3-1-5-文档（Document）"><a href="#3-1-5-文档（Document）" class="headerlink" title="3.1.5 文档（Document）"></a>3.1.5 文档（Document）</h4><p>一个可以被索引的数据单元。例如一个用户的文档、一个产品的文档等等。文档都是 JSON 格式的。</p>
<h4 id="3-1-6-分片（Shards）"><a href="#3-1-6-分片（Shards）" class="headerlink" title="3.1.6 分片（Shards）"></a>3.1.6 分片（Shards）</h4><p>索引都是存储在节点上的，但是受限于节点的空间大小以及数据处理能力，单个节点的处理效果可能不理想，此时我们可以对索引进行分片。当我们创建一个索引的时候，就需要指定分片的数量。每个分片本身也是一个功能完善并且独立的索引。</p>
<p>默认情况下，一个索引会自动创建 1 个分片，并且为每一个分片创建一个副本。</p>
<h4 id="3-1-7-副本（Replicas）"><a href="#3-1-7-副本（Replicas）" class="headerlink" title="3.1.7 副本（Replicas）"></a>3.1.7 副本（Replicas）</h4><p>副本也就是备份，是对主分片的一个备份。</p>
<h4 id="3-1-8-Settings"><a href="#3-1-8-Settings" class="headerlink" title="3.1.8 Settings"></a>3.1.8 Settings</h4><p>集群中对索引的定义信息，例如索引的分片数、副本数等等。</p>
<h4 id="3-1-9-Mapping"><a href="#3-1-9-Mapping" class="headerlink" title="3.1.9 Mapping"></a>3.1.9 Mapping</h4><p>Mapping 保存了定义索引字段的存储类型、分词方式、是否存储等信息。</p>
<h4 id="3-1-10-Analyzer"><a href="#3-1-10-Analyzer" class="headerlink" title="3.1.10 Analyzer"></a>3.1.10 Analyzer</h4><p>字段分词方式的定义。</p>
<h3 id="3-2-ElasticSearch-Vs-关系型数据库"><a href="#3-2-ElasticSearch-Vs-关系型数据库" class="headerlink" title="3.2 ElasticSearch Vs 关系型数据库"></a>3.2 ElasticSearch Vs 关系型数据库</h3><p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYmWb3k1hyO9xNiclsZrichz6edvm33AAFXGtxSgicMJg14Vp3TINYgqn8Ayj7vR86yiawSP8ibbKviaibWsA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h1 id="内置分词器"><a href="#内置分词器" class="headerlink" title="内置分词器"></a>内置分词器</h1><p>ElasticSearch 核心功能就是数据检索，首先通过索引将文档写入 es。查询分析则主要分为两个步骤：</p>
<ol>
<li>词条化：<strong>分词器</strong>将输入的文本转为一个一个的词条流。</li>
<li>过滤：比如停用词过滤器会从词条中去除不相干的词条（的，嗯，啊，呢）；另外还有同义词过滤器、小写过滤器等。</li>
</ol>
<p>ElasticSearch 中内置了多种分词器可以供使用。</p>
<p>内置分词器：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPoBThOldjMPQI23ichULtgRCqDFRibGZ3LEeNclY3aywMzzWrialtT95uA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="4-2-中文分词器"><a href="#4-2-中文分词器" class="headerlink" title="4.2 中文分词器"></a>4.2 中文分词器</h3><p>在 Es 中，使用较多的中文分词器是 elasticsearch-analysis-ik，这个是 es 的一个第三方插件，代码托管在 GitHub 上：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></li>
</ul>
<h4 id="4-2-1-安装"><a href="#4-2-1-安装" class="headerlink" title="4.2.1 安装"></a>4.2.1 安装</h4><p>两种使用方式：</p>
<p><strong>第一种：</strong></p>
<ol>
<li>首先打开分词器官网：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik%E3%80%82">https://github.com/medcl/elasticsearch-analysis-ik。</a></li>
<li>在 <a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a> 页面找到最新的正式版，下载下来。我们这里的下载链接是 <a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.9.3/elasticsearch-analysis-ik-7.9.3.zip%E3%80%82">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.9.3/elasticsearch-analysis-ik-7.9.3.zip。</a></li>
<li>将下载文件解压。</li>
<li>在 es/plugins 目录下，新建 ik 目录，并将解压后的所有文件拷贝到 ik 目录下。</li>
<li>重启 es 服务。</li>
</ol>
<p><strong>第二种：</strong></p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">shengbinbin@192 plugins % brew list</span><br><span class="line">==&gt; Formulae</span><br><span class="line">autoconf		icu4c			maven			pkg-config</span><br><span class="line">brotli			jemalloc		mysql			protobuf</span><br><span class="line">c-ares			kibana-full		nghttp2			redis</span><br><span class="line">elasticsearch-full	libev			node			tcl-tk</span><br><span class="line">freetype		libpng			openjdk</span><br><span class="line">git-gui			libuv			openjdk@11</span><br><span class="line">gradle			m4			openssl@1.1</span><br><span class="line">shengbinbin@192 plugins % brew info elasticsearch-full</span><br><span class="line">elastic/tap/elasticsearch-full: stable 7.13.2</span><br><span class="line">Distributed search &amp; analytics engine</span><br><span class="line">https://www.elastic.co/products/elasticsearch</span><br><span class="line">Conflicts with:</span><br><span class="line">  elasticsearch</span><br><span class="line">/opt/homebrew/Cellar/elasticsearch-full/7.13.2 (957 files, 504.8MB) *</span><br><span class="line">  Built from <span class="built_in">source</span> on 2021-06-29 at 20:46:00</span><br><span class="line">From: https://github.com/elastic/homebrew-tap/blob/HEAD/Formula/elasticsearch-full.rb</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Data:    /opt/homebrew/var/lib/elasticsearch/elasticsearch_shengbinbin/</span><br><span class="line">Logs:    /opt/homebrew/var/<span class="built_in">log</span>/elasticsearch/elasticsearch_shengbinbin.log</span><br><span class="line">Plugins: /opt/homebrew/var/elasticsearch/plugins/</span><br><span class="line">Config:  /opt/homebrew/etc/elasticsearch/</span><br><span class="line"></span><br><span class="line">To have launchd start elastic/tap/elasticsearch-full now and restart at login:</span><br><span class="line">  brew services start elastic/tap/elasticsearch-full</span><br><span class="line">Or, <span class="keyword">if</span> you don<span class="string">&#x27;t want/need a background service you can just run:</span></span><br><span class="line"><span class="string">  elasticsearch</span></span><br><span class="line"><span class="string">shengbinbin@192 plugins % cd /opt/homebrew/Cellar/elasticsearch-full/7.13.2</span></span><br><span class="line"><span class="string">shengbinbin@192 7.13.2 % ls</span></span><br><span class="line"><span class="string">INSTALL_RECEIPT.json			bin</span></span><br><span class="line"><span class="string">LICENSE.txt				homebrew.mxcl.elasticsearch-full.plist</span></span><br><span class="line"><span class="string">NOTICE.txt				libexec</span></span><br><span class="line"><span class="string">README.asciidoc</span></span><br><span class="line"><span class="string">													//安装命令</span></span><br><span class="line"><span class="string">shengbinbin@192 7.13.2 % ./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.13.2/elasticsearch-analysis-ik-7.13.2.zip</span></span><br><span class="line"><span class="string">warning: usage of JAVA_HOME is deprecated, use ES_JAVA_HOME</span></span><br><span class="line"><span class="string">Future versions of Elasticsearch will require Java 11; your Java version from [/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home/jre] does not meet this requirement. Consider switching to a distribution of Elasticsearch with a bundled JDK. If you are already using a distribution with a bundled JDK, ensure the JAVA_HOME environment variable is not set.</span></span><br><span class="line"><span class="string">-&gt; Installing https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.13.2/elasticsearch-analysis-ik-7.13.2.zip</span></span><br><span class="line"><span class="string">-&gt; Downloading https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.13.2/elasticsearch-analysis-ik-7.13.2.zip</span></span><br><span class="line"><span class="string">[=================================================] 100%</span></span><br><span class="line"><span class="string">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span><br><span class="line"><span class="string">@     WARNING: plugin requires additional permissions     @</span></span><br><span class="line"><span class="string">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span><br><span class="line"><span class="string">* java.net.SocketPermission * connect,resolve</span></span><br><span class="line"><span class="string">See http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html</span></span><br><span class="line"><span class="string">for descriptions of what these permissions allow and the associated risks.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Continue with installation? [y/N]y</span></span><br><span class="line"><span class="string">-&gt; Installed analysis-ik</span></span><br><span class="line"><span class="string">-&gt; Please restart Elasticsearch to activate any plugins installed</span></span><br><span class="line"><span class="string">shengbinbin@192 7.13.2 %</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.13.2/elasticsearch-analysis-ik-7.13.2.zip</span><br></pre></td></tr></table></figure>



<h4 id="4-2-2-测试"><a href="#4-2-2-测试" class="headerlink" title="4.2.2 测试"></a>4.2.2 测试</h4><p>es 重启成功后，首先创建一个名为 test 的索引：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPhsuntznkiaibtJP6msRicBcLpnibS9KKB5PSHbrNLo02XU13pqWW5l0bSw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>接下来，在该索引中进行分词测试：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPEyn6Ku9JNJkwHoswIYwTQhrRV90SiaOs2JLRg3M6ibGAScjU3708xgcg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h4 id="4-2-3-自定义扩展词库"><a href="#4-2-3-自定义扩展词库" class="headerlink" title="4.2.3 自定义扩展词库"></a>4.2.3 自定义扩展词库</h4><h5 id="4-2-3-1-本地自定义"><a href="#4-2-3-1-本地自定义" class="headerlink" title="4.2.3.1 本地自定义"></a>4.2.3.1 本地自定义</h5><p>在 es/plugins/ik/config 目录下，新建 ext.dic 文件（文件名任意），在该文件中可以配置自定义的词库。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPRAwJqk6MmZ2tCIIcLINdXw2WtU2Cla03qoibD4V16VmeSjAMVv1HVvw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>如果有多个词，换行写入新词即可。</p>
<p>然后在 es/plugins/ik/config/IKAnalyzer.cfg.xml 中配置扩展词典的位置：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPPCzgzYG9Nm8Y0B9WaqldVYyRSvXyqcLdyiaibv4cT0YCYlDn5iaz59mNA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h5 id="4-2-3-2-远程词库"><a href="#4-2-3-2-远程词库" class="headerlink" title="4.2.3.2 远程词库"></a>4.2.3.2 远程词库</h5><p>也可以配置远程词库，远程词库支持热更新（不用重启 es 就可以生效）。</p>
<p>热更新只需要提供一个接口，接口返回扩展词即可。</p>
<p>具体使用方式如下，新建一个 Spring Boot 项目，引入 Web 依赖即可。然后在 resources/stastic 目录下新建 ext.dic 文件，写入扩展词：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPH3d1z49Rg9hsvxfjXgErBStFdF61cCo3aA430udggtgUJCaGQyiamLg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>接下来，在 es/plugins/ik/config/IKAnalyzer.cfg.xml 文件中配置远程扩展词接口：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYlgRayKeLC6k8IjT8wAb9FPhCTFQHzM9wBAib8TCR3FWiasNrkgFlVvoCuKaqHziaibf5pIicUx2Q5vicWg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>配置完成后，重启 es ，即可生效。</p>
<p>热更新，主要是响应头的 <code>Last-Modified</code> 或者 <code>ETag</code> 字段发生变化，ik 就会自动重新加载远程扩展</p>
<h1 id="索引的基本操作"><a href="#索引的基本操作" class="headerlink" title="索引的基本操作"></a>索引的基本操作</h1><h2 id="新建索引"><a href="#新建索引" class="headerlink" title="新建索引"></a>新建索引</h2><h4 id="通过-head-插件新建索引"><a href="#通过-head-插件新建索引" class="headerlink" title="通过 head 插件新建索引"></a>通过 head 插件新建索引</h4><p>在 head 插件中，选择 索引选项卡，然后点击新建索引。新建索引时，需要填入索引名称、分片数以及副本数。</p>
<p><img src="https://i.loli.net/2021/06/30/6j3YeLbhK85tDay.png"></p>
<p>索引创建成功后，如下图：</p>
<p><img src="https://i.loli.net/2021/06/30/WFUzxgKIp4rfh5P.png"></p>
<p>0、1、2、3、4 分别表示索引的分片，粗框表示主分片，细框表示副本（点一下框，通过 primary 属性可以查看是主分片还是副本）。</p>
<h4 id="通过-kibana-发送请求创建"><a href="#通过-kibana-发送请求创建" class="headerlink" title="通过 kibana 发送请求创建"></a>通过 kibana 发送请求创建</h4><p>创建索引请求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT user</span><br></pre></td></tr></table></figure>

<p>创建成功后，返回如下信息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;shards_acknowledged&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;index&quot;</span> : <span class="string">&quot;user&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查看user这个索引的信息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">&quot;mapping_version&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;settings_version&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;aliases_version&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;routing_num_shards&quot;</span>: <span class="number">1024</span>,</span><br><span class="line">    <span class="attr">&quot;state&quot;</span>: <span class="string">&quot;open&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;routing&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;allocation&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;include&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;_tier_preference&quot;</span>: <span class="string">&quot;data_content&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;provided_name&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;creation_date&quot;</span>: <span class="string">&quot;1625048332811&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;uuid&quot;</span>: <span class="string">&quot;IPeNFtZcQ8OEUfNEVryexg&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;created&quot;</span>: <span class="string">&quot;7130299&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span>: &#123; &#125;,</span><br><span class="line">    <span class="attr">&quot;aliases&quot;</span>: [ ],</span><br><span class="line">    <span class="attr">&quot;primary_terms&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;0&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line">    <span class="attr">&quot;in_sync_allocations&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;0&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;ely2hxs1QdiRcTy0YB9Rmw&quot;</span></span><br><span class="line">]</span><br><span class="line">&#125;,</span><br><span class="line">    <span class="attr">&quot;rollover_info&quot;</span>: &#123; &#125;,</span><br><span class="line">    <span class="attr">&quot;system&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;timestamp_range&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;unknown&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="索引的要求"><a href="#索引的要求" class="headerlink" title="索引的要求"></a>索引的要求</h3><ul>
<li><p>索引名称不能有大写字母</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;error&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;invalid_index_name_exception&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;reason&quot;</span> : <span class="string">&quot;Invalid index name [uSER], must be lowercase&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;index_uuid&quot;</span> : <span class="string">&quot;_na_&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;index&quot;</span> : <span class="string">&quot;uSER&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;invalid_index_name_exception&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;reason&quot;</span> : <span class="string">&quot;Invalid index name [uSER], must be lowercase&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;index_uuid&quot;</span> : <span class="string">&quot;_na_&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;index&quot;</span> : <span class="string">&quot;uSER&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span> : <span class="number">400</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>索引名是唯一的，不能重复，重复创建会出错</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;error&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;resource_already_exists_exception&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;reason&quot;</span> : <span class="string">&quot;index [user/IPeNFtZcQ8OEUfNEVryexg] already exists&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;index_uuid&quot;</span> : <span class="string">&quot;IPeNFtZcQ8OEUfNEVryexg&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;index&quot;</span> : <span class="string">&quot;user&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;resource_already_exists_exception&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;reason&quot;</span> : <span class="string">&quot;index [user/IPeNFtZcQ8OEUfNEVryexg] already exists&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;index_uuid&quot;</span> : <span class="string">&quot;IPeNFtZcQ8OEUfNEVryexg&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;index&quot;</span> : <span class="string">&quot;user&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span> : <span class="number">400</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="更新索引"><a href="#更新索引" class="headerlink" title="更新索引"></a>更新索引</h2><p>索引创建好之后，可以修改其属性。</p>
<h3 id="修改副本数"><a href="#修改副本数" class="headerlink" title="修改副本数"></a>修改副本数</h3><p>例如修改索引的副本数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT user/_settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;number_of_replicas&quot;: &quot;2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更新分片数也是一样。</p>
<h3 id="向索引中写入文档"><a href="#向索引中写入文档" class="headerlink" title="向索引中写入文档"></a>向索引中写入文档</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT user/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;三国演义&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;user&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;result&quot;</span> : <span class="string">&quot;created&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">3</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![](https:<span class="comment">//i.loli.net/2021/06/30/ZLHmCIfcAMgJvKX.png)</span></span><br><span class="line"></span><br><span class="line">### 修改索引的读写权限</span><br><span class="line"></span><br><span class="line">默认情况下，索引是具备读写权限的，当然这个读写权限可以关闭。</span><br><span class="line"></span><br><span class="line">例如，关闭索引的写权限：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>PUT user/_settings<br>{<br>  “blocks.write”: “true”<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">关闭之后，就无法添加文档了。关闭了写权限之后，如果想要再次打开，方式如下：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>PUT user/_settings<br>{<br>  “blocks.write”: “true”<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">其他类似的权限有：</span><br><span class="line"></span><br><span class="line">- blocks.write</span><br><span class="line">- blocks.read</span><br><span class="line">- blocks.read_only</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 查看索引信息</span><br><span class="line"></span><br><span class="line">- head 插件查看方式如下</span><br><span class="line"></span><br><span class="line">- 请求查看方式如下：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>GET book/_settings</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">​```JSON</span><br><span class="line">&#123;</span><br><span class="line">  &quot;user&quot; : &#123;</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;index&quot; : &#123;</span><br><span class="line">        &quot;routing&quot; : &#123;</span><br><span class="line">          &quot;allocation&quot; : &#123;</span><br><span class="line">            &quot;include&quot; : &#123;</span><br><span class="line">              &quot;_tier_preference&quot; : &quot;data_content&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;number_of_shards&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;blocks&quot; : &#123;</span><br><span class="line">          &quot;write&quot; : &quot;false&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;provided_name&quot; : &quot;user&quot;,</span><br><span class="line">        &quot;creation_date&quot; : &quot;1625048332811&quot;,</span><br><span class="line">        &quot;number_of_replicas&quot; : &quot;2&quot;,</span><br><span class="line">        &quot;uuid&quot; : &quot;IPeNFtZcQ8OEUfNEVryexg&quot;,</span><br><span class="line">        &quot;version&quot; : &#123;</span><br><span class="line">          &quot;created&quot; : &quot;7130299&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以同时查看多个索引信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET user,test/_settings</span><br></pre></td></tr></table></figure>

<p>也可以查看所有索引信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _all/_settings</span><br></pre></td></tr></table></figure>

<h2 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h2><ul>
<li><p>head 插件可以删除索引：</p>
</li>
<li><p>请求删除如下：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE test</span><br></pre></td></tr></table></figure>

<p>删除一个不存在的索引会报错。</p>
<h2 id="索引打开-关闭"><a href="#索引打开-关闭" class="headerlink" title="索引打开/关闭"></a>索引打开/关闭</h2><p>关闭索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST book/_close</span><br></pre></td></tr></table></figure>

<p>打开索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST book/_open</span><br></pre></td></tr></table></figure>

<p>当然，可以同时关闭/打开多个索引，多个索引用 , 隔开，或者直接使用 _all 代表所有索引。</p>
<h2 id="复制索引"><a href="#复制索引" class="headerlink" title="复制索引"></a>复制索引</h2><p>索引复制，只会复制数据，不会复制索引配置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _reindex</span><br><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: &#123;&quot;index&quot;:&quot;book&quot;&#125;,</span><br><span class="line">  &quot;dest&quot;: &#123;&quot;index&quot;:&quot;book_new&quot;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复制的时候，可以添加查询条件。</p>
<h2 id="索引别名"><a href="#索引别名" class="headerlink" title="索引别名"></a>索引别名</h2><p>可以为索引创建别名，如果这个别名是唯一的，该别名可以代替索引名称。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;book_alias&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将 add 改为 remove 就表示移除别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;remove&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;book_alias&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看某一个索引的别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /book/_alias</span><br></pre></td></tr></table></figure>

<p>查看某一个别名对应的索引（book_alias 表示一个别名）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /book_alias/_alias</span><br></pre></td></tr></table></figure>

<p>可以查看集群上所有可用别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_alias</span><br></pre></td></tr></table></figure>





<h1 id="文档的基本操作"><a href="#文档的基本操作" class="headerlink" title="文档的基本操作"></a>文档的基本操作</h1><h2 id="新建文档"><a href="#新建文档" class="headerlink" title="新建文档"></a>新建文档</h2><p>新建索引blog，在添加文档：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT blog/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;文档基本操作&quot;,</span><br><span class="line">  &quot;date&quot;:&quot;2021-06-30&quot;,</span><br><span class="line">  &quot;content&quot;:&quot;添加的文档的基本操作&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;blog&quot;</span>,  </span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> : <span class="number">1</span>,		<span class="comment">//如果更新文档，版本会自动 + 1 </span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> : <span class="string">&quot;created&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;		  <span class="comment">//分片信息</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> : <span class="number">0</span>,		</span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>添加文档如果不指定id，系统会默认给一个id，但是需要修改成post请求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST blog/_doc</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;666&quot;,</span><br><span class="line">  &quot;date&quot;:&quot;2021-06-30&quot;,</span><br><span class="line">  &quot;content&quot;:&quot;添加的文档的基本操作&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;blog&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1hrCXHoBjgQwlk7iYnof&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;result&quot;</span> : <span class="string">&quot;created&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h2><p>get api：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET blog/_doc/1</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;blog&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;found&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;title&quot;</span> : <span class="string">&quot;文档基本操作&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;date&quot;</span> : <span class="string">&quot;2021-06-30&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;content&quot;</span> : <span class="string">&quot;添加的文档的基本操作&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>批量查询文档：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET blog/_mget</span><br><span class="line">&#123;</span><br><span class="line">  &quot;ids&quot;:[&quot;1&quot;,&quot;1hrCXHoBjgQwlk7iYnof&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>为什么这里的get请求可以携带请求体呢？</p>
<p>某些特定的语言比如JavaScript的http请求中不允许get请求有请求体，但是在RFC7231文档中，并没有规定GET请求的请求体如何处理。es为了保证兼容性，get和post都可以 </p>
</blockquote>
<h2 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h2><blockquote>
<p>文档更新1次，version就+1</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT blog/_doc/1hrCXHoBjgQwlk7iYnof</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;777&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注 ： 这种方式更新的文档会覆盖掉原文档</p>
<p>大多数时候我们只是想更新文档中的字段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">POST blog/_update/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;script&quot;: &#123;</span><br><span class="line">    &quot;lang&quot;: &quot;painless&quot;,</span><br><span class="line">    &quot;source&quot;: &quot;ctx._source.title=params.title&quot;,</span><br><span class="line">    &quot;params&quot;: &#123;</span><br><span class="line">      &quot;title&quot;:&quot;666666&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">更新的请求格式：</span><br><span class="line"></span><br><span class="line">POST &#123;index&#125;/_update/&#123;id&#125;&#123;</span><br><span class="line">	 lang 表示脚本语言</span><br><span class="line">	 painless 是es中内置的一种脚本语言</span><br><span class="line">	 source 表示具体执行的脚本</span><br><span class="line">	 ctx 是一个上下文对象，通过ctx可以访问到_source、_title等</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>向文档中添加tag字段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST blog/_update/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;script&quot;: &#123;</span><br><span class="line">    &quot;lang&quot;: &quot;painless&quot;,</span><br><span class="line">    &quot;source&quot;: &quot;ctx._source.tag=[\&quot;java\&quot;,\&quot;php\&quot;]&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST blog/_update/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;script&quot;: &#123;</span><br><span class="line">    &quot;lang&quot;: &quot;painless&quot;,</span><br><span class="line">    &quot;source&quot;: &quot;ctx._source.tag.add(\&quot;js\&quot;)&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用if、else语句：如果tags里面含有Java，就删除这个文档。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST blog/_update/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;script&quot;: &#123;</span><br><span class="line">    &quot;lang&quot;: &quot;painless&quot;,</span><br><span class="line">    &quot;source&quot;: &quot;if(ctx._source.tag.contains(\&quot;java\&quot;))&#123; ctx.op = \&quot;delete\&quot;&#125;else&#123;ctx.op=\&quot;none\&quot;&#125;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="查询更新"><a href="#查询更新" class="headerlink" title="查询更新"></a>查询更新</h2><p>通过条件查询到文档，然后再去更新</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">讲title中包含666的文档的内容修改为888</span><br><span class="line">POST blog/_update_by_query</span><br><span class="line">&#123;</span><br><span class="line">  &quot;script&quot;: &#123;</span><br><span class="line">    &quot;source&quot;: &quot;ctx._source.content=\&quot;888\&quot;&quot;,</span><br><span class="line">    &quot;lang&quot;: &quot;painless&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;title&quot;:&quot;777&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE blog/_doc/1hrCXHoBjgQwlk7iYnof</span><br></pre></td></tr></table></figure>



<h2 id="查询删除"><a href="#查询删除" class="headerlink" title="查询删除"></a>查询删除</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">删除 title 中包含 666 的文档</span><br><span class="line">POST blog/_delete_by_query</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;term&quot;:&#123;</span><br><span class="line">      &quot;title&quot;:&quot;666&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">删除某一个索引下的所有文档</span><br><span class="line">POST blog/_delete_by_query</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match_all&quot;:&#123;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="批量操作"><a href="#批量操作" class="headerlink" title="批量操作"></a>批量操作</h3><p>es 中通过 Bulk API 可以执行批量索引、批量删除、批量更新等操作。</p>
<p>首先需要将所有的批量操作写入一个 JSON 文件中，然后通过 POST 请求将该 JSON 文件上传并执行。</p>
<p><img src="https://i.loli.net/2021/06/30/7jiwOA1WZHTInxN.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST &quot;http://localhost:9200/user/_bulk&quot; -H &quot;content-type:application/json&quot; --data-binary @aaa.json</span><br></pre></td></tr></table></figure>

<p>执行完成后，就会创建一个名为 user 的索引，同时向该索引中添加一条记录，再修改该记录，最终结果如下：</p>
<h2 id="文档路由"><a href="#文档路由" class="headerlink" title="文档路由"></a>文档路由</h2><p>你的数据到底存在哪一个分片上？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/shards/blog?v   可以查看文档在哪个分片上</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">index shard prirep state      docs store ip        node</span><br><span class="line">blog  4     p      STARTED       0 7.9kb 127.0.0.1 192.168.0.107</span><br><span class="line">blog  4     r      UNASSIGNED                      </span><br><span class="line">blog  1     p      STARTED       2 8.3kb 127.0.0.1 192.168.0.107</span><br><span class="line">blog  1     r      UNASSIGNED                      </span><br><span class="line">blog  2     p      STARTED       1 3.6kb 127.0.0.1 192.168.0.107</span><br><span class="line">blog  2     r      UNASSIGNED                      </span><br><span class="line">blog  3     p      STARTED       1 3.6kb 127.0.0.1 192.168.0.107</span><br><span class="line">blog  3     r      UNASSIGNED                      </span><br><span class="line">blog  0     p      STARTED       1 3.6kb 127.0.0.1 192.168.0.107</span><br><span class="line">blog  0     r      UNASSIGNED                      </span><br></pre></td></tr></table></figure>



<p>es 中的路由机制是通过哈希算法，将具有相同哈希值的文档放到一个主分片中，分片位置的计算方式如下：</p>
<p>shard=hash(routing) % number_of_primary_shards</p>
<p>routing 可以是一个任意字符串，<strong>es 默认是将文档的 id 作为 routing 值，通过哈希函数根据 routing 生成一个数字，然后将该数字和分片数取余，取余的结果就是分片的位置。</strong></p>
<p>默认的这种路由模式，最大的优势在于负载均衡，这种方式可以保证数据平均分配在不同的分片上。但是他有一个很大的劣势，就是查询时候无法确定文档的位置，此时它会将请求广播到所有的分片上去执行。另一方面，使用默认的路由模式，后期修改分片数量不方便。</p>
<p>然开发者也可以自定义 routing 的值，方式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT blog/_doc/d?routing=javaboy</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;d&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果文档在添加时指定了 routing，则查询、删除、更新时也需要指定 routing。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET blog/_doc/d?routing=javaboy</span><br></pre></td></tr></table></figure>

<p>自定义 routing 有可能会导致负载不均衡，这个还是要结合实际情况选择。</p>
<p>典型场景：</p>
<p>对于用户数据，我们可以将 userid 作为 routing，这样就能保证同一个用户的数据保存在同一个分片中，检索时，同样使用 userid 作为 routing，这样就可以精准的从某一个分片中获取数据。</p>
<h1 id="ES的版本控制"><a href="#ES的版本控制" class="headerlink" title="ES的版本控制"></a>ES的版本控制</h1><p>当我们使用 es 的 API 去进行文档更新时，它首先读取原文档出来，然后对原文档进行更新，更新完成后再重新索引整个文档。不论你执行多少次更新，最终保存在 es 中的是最后一次更新的文档。但是如果有两个线程同时去更新，就有可能出问题。</p>
<p>要解决问题，就是锁。在 es 中，实际上使用的就是乐观锁。</p>
<h3 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h3><p><strong>es6.7之前</strong></p>
<p>在 es6.7 之前，使用 version+version_type 来进行乐观并发控制。根据前面的介绍，文档每被修改一个，version 就会自增一次，es 通过 version 字段来确保所有的操作都有序进行。</p>
<p>version 分为内部版本控制和外部版本控制。</p>
<h4 id="内部版本"><a href="#内部版本" class="headerlink" title="内部版本"></a>内部版本</h4><p>es 自己维护的就是内部版本，当创建一个文档时，es 会给文档的版本赋值为 1。</p>
<p>每当用户修改一次文档，版本号就回自增 1。</p>
<p>如果使用内部版本，es 要求 version 参数的值必须和 es 文档中 version 的值相当，才能操作成功。</p>
<h4 id="外部版本"><a href="#外部版本" class="headerlink" title="外部版本"></a>外部版本</h4><p>也可以维护外部版本。</p>
<p>在添加文档时，就指定版本号：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT blog/_doc/1?version=200&amp;version_type=external</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;2222&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以后更新的时候，版本要大于已有的版本号。</p>
<ul>
<li>vertion_type=external 或者 vertion_type=external_gt 表示以后更新的时候，版本要大于已有的版本号。</li>
<li>vertion_type=external_gte 表示以后更新的时候，版本要大于等于已有的版本号。</li>
</ul>
<h4 id="最新方案（Es6-7-之后）"><a href="#最新方案（Es6-7-之后）" class="headerlink" title="最新方案（Es6.7 之后）"></a>最新方案（Es6.7 之后）</h4><p>现在使用 <code>if_seq_no</code> 和 <code>if_primary_term</code> 两个参数来做并发控制。</p>
<p><code>seq_no</code> 不属于某一个文档，它是属于整个索引的（version 则是属于某一个文档的，每个文档的 version 互不影响）。现在更新文档时，使用 <code>seq_no</code> 来做并发。由于 <code>seq_no</code> 是属于整个 index 的，所以任何文档的修改或者新增，<code>seq_no</code> 都会自增。</p>
<p>现在就可以通过 <code>seq_no</code> 和 <code>primary_term</code> 来做乐观并发控制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT blog/_doc/2?if_seq_no=5&amp;if_primary_term=1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;6666&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h1><p>倒排索引是 es 中非常重要的索引结构，是从<strong>文档词项到文档 ID</strong> 的一个映射过程。</p>
<h3 id="“正排索引”"><a href="#“正排索引”" class="headerlink" title="“正排索引”"></a>“正排索引”</h3><p>我们在关系型数据库中见到的索引，就是“正排索引”。</p>
<p>关系型数据库中的索引如下，假设我有一个博客表：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>作者</th>
<th>标题</th>
<th>内容</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>binshow</td>
<td>哈哈哈哈</td>
<td>xxxx</td>
</tr>
<tr>
<td>2</td>
<td>zkd</td>
<td>嘻嘻嘻嘻</td>
<td>xxxxx</td>
</tr>
</tbody></table>
<p>我们可以针对这个表建立索引（正排索引）：</p>
<table>
<thead>
<tr>
<th>索引</th>
<th>内容</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>xxxx</td>
</tr>
<tr>
<td>2</td>
<td>xxxxx</td>
</tr>
<tr>
<td>哈哈哈哈</td>
<td>xxxx</td>
</tr>
<tr>
<td>嘻嘻嘻嘻</td>
<td>xxxxx</td>
</tr>
</tbody></table>
<p>当我们通过 id 或者标题去搜索文章时，就可以快速搜到。</p>
<p>但是如果我们按照文章内容的关键字去搜索，就只能去内容中做字符匹配了。为了提高查询效率，就要考虑使用倒排索引。</p>
<h3 id="倒排索引-1"><a href="#倒排索引-1" class="headerlink" title="倒排索引"></a>倒排索引</h3><p><strong>倒排索引就是以内容的关键字建立索引，通过索引找到文档 id，再进而找到整个文档。</strong></p>
<table>
<thead>
<tr>
<th>索引</th>
<th>文档id=1</th>
<th>文档id=2</th>
</tr>
</thead>
<tbody><tr>
<td>Java</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>es</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>索引</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>php</td>
<td></td>
<td>✅</td>
</tr>
</tbody></table>
<p>一般来说，倒排索引分为两个部分：</p>
<ul>
<li>单词词典（记录所有的文档词项，以及词项到倒排列表的关联关系）</li>
<li>倒排列表（记录单词与对应的关系，由一系列倒排索引项组成，倒排索引项指：<strong>文档 id、词频（TF）（词项在文档中出现的次数，评分时使用）、位置（Position，词项在文档中分词的位置）、偏移（记录词项开始和结束的位置）</strong>）</li>
</ul>
<p>当我们去索引一个文档时，就回建立倒排索引，搜索时，直接根据倒排索引搜索。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>ElasticSearch从入门到实战</p><p><a href="http://example.com/2021/06/29/ElasticSearch从入门到实战/">http://example.com/2021/06/29/ElasticSearch从入门到实战/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>binshow</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-06-29</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-07-01</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/ElasticSearch/">ElasticSearch</a></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/" alt="支付宝"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/06/30/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%89%EF%BC%89%E8%A7%84%E8%8C%83%E5%92%8C%E9%87%8D%E6%9E%84%E5%AE%9E%E6%88%98/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">设计模式（三）规范和重构实战</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/06/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%BA%8C%EF%BC%89%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/"><span class="level-item">设计模式（二）设计原则</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="binshow"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">binshow</p><p class="is-size-6 is-block">后台开发工程师</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>安徽</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">48</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">1</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">12</p></a></div></div></nav></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#ElasticSearch简介"><span class="level-left"><span class="level-item">1</span><span class="level-item">ElasticSearch简介</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Lucene"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Lucene</span></span></a></li><li><a class="level is-mobile" href="#ElasticSearch"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">ElasticSearch</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ElasticSearch安装（homebrew）"><span class="level-left"><span class="level-item">2</span><span class="level-item">ElasticSearch安装（homebrew）</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#HEAD-插件安装"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">HEAD 插件安装</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#2-3-分布式安装"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">2.3 分布式安装</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Kibana-安装"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Kibana 安装</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ElasticSearch-十大核心概念"><span class="level-left"><span class="level-item">3</span><span class="level-item">ElasticSearch 十大核心概念</span></span></a><ul class="menu-list"><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#3-1-1-集群（Cluster）"><span class="level-left"><span class="level-item">3.1.1.1</span><span class="level-item">3.1.1 集群（Cluster）</span></span></a></li><li><a class="level is-mobile" href="#3-1-2-节点（Node）"><span class="level-left"><span class="level-item">3.1.1.2</span><span class="level-item">3.1.2 节点（Node）</span></span></a></li><li><a class="level is-mobile" href="#3-1-3-索引（Index）"><span class="level-left"><span class="level-item">3.1.1.3</span><span class="level-item">3.1.3 索引（Index）</span></span></a></li><li><a class="level is-mobile" href="#3-1-4-类型（Type）"><span class="level-left"><span class="level-item">3.1.1.4</span><span class="level-item">3.1.4 类型（Type）</span></span></a></li><li><a class="level is-mobile" href="#3-1-5-文档（Document）"><span class="level-left"><span class="level-item">3.1.1.5</span><span class="level-item">3.1.5 文档（Document）</span></span></a></li><li><a class="level is-mobile" href="#3-1-6-分片（Shards）"><span class="level-left"><span class="level-item">3.1.1.6</span><span class="level-item">3.1.6 分片（Shards）</span></span></a></li><li><a class="level is-mobile" href="#3-1-7-副本（Replicas）"><span class="level-left"><span class="level-item">3.1.1.7</span><span class="level-item">3.1.7 副本（Replicas）</span></span></a></li><li><a class="level is-mobile" href="#3-1-8-Settings"><span class="level-left"><span class="level-item">3.1.1.8</span><span class="level-item">3.1.8 Settings</span></span></a></li><li><a class="level is-mobile" href="#3-1-9-Mapping"><span class="level-left"><span class="level-item">3.1.1.9</span><span class="level-item">3.1.9 Mapping</span></span></a></li><li><a class="level is-mobile" href="#3-1-10-Analyzer"><span class="level-left"><span class="level-item">3.1.1.10</span><span class="level-item">3.1.10 Analyzer</span></span></a></li></ul><li><a class="level is-mobile" href="#3-2-ElasticSearch-Vs-关系型数据库"><span class="level-left"><span class="level-item">3.1.2</span><span class="level-item">3.2 ElasticSearch Vs 关系型数据库</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#内置分词器"><span class="level-left"><span class="level-item">4</span><span class="level-item">内置分词器</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#4-2-中文分词器"><span class="level-left"><span class="level-item">4.1.1</span><span class="level-item">4.2 中文分词器</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#4-2-1-安装"><span class="level-left"><span class="level-item">4.1.1.1</span><span class="level-item">4.2.1 安装</span></span></a></li><li><a class="level is-mobile" href="#4-2-2-测试"><span class="level-left"><span class="level-item">4.1.1.2</span><span class="level-item">4.2.2 测试</span></span></a></li><li><a class="level is-mobile" href="#4-2-3-自定义扩展词库"><span class="level-left"><span class="level-item">4.1.1.3</span><span class="level-item">4.2.3 自定义扩展词库</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#4-2-3-1-本地自定义"><span class="level-left"><span class="level-item">4.1.1.3.1</span><span class="level-item">4.2.3.1 本地自定义</span></span></a></li><li><a class="level is-mobile" href="#4-2-3-2-远程词库"><span class="level-left"><span class="level-item">4.1.1.3.2</span><span class="level-item">4.2.3.2 远程词库</span></span></a></li></ul></li></ul></li></ul></ul></li><li><a class="level is-mobile" href="#索引的基本操作"><span class="level-left"><span class="level-item">5</span><span class="level-item">索引的基本操作</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#新建索引"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">新建索引</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#通过-head-插件新建索引"><span class="level-left"><span class="level-item">5.1.1.1</span><span class="level-item">通过 head 插件新建索引</span></span></a></li><li><a class="level is-mobile" href="#通过-kibana-发送请求创建"><span class="level-left"><span class="level-item">5.1.1.2</span><span class="level-item">通过 kibana 发送请求创建</span></span></a></li></ul><li><a class="level is-mobile" href="#索引的要求"><span class="level-left"><span class="level-item">5.1.2</span><span class="level-item">索引的要求</span></span></a></li></ul></li><li><a class="level is-mobile" href="#更新索引"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">更新索引</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#修改副本数"><span class="level-left"><span class="level-item">5.2.1</span><span class="level-item">修改副本数</span></span></a></li><li><a class="level is-mobile" href="#向索引中写入文档"><span class="level-left"><span class="level-item">5.2.2</span><span class="level-item">向索引中写入文档</span></span></a></li></ul></li><li><a class="level is-mobile" href="#删除索引"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">删除索引</span></span></a></li><li><a class="level is-mobile" href="#索引打开-关闭"><span class="level-left"><span class="level-item">5.4</span><span class="level-item">索引打开/关闭</span></span></a></li><li><a class="level is-mobile" href="#复制索引"><span class="level-left"><span class="level-item">5.5</span><span class="level-item">复制索引</span></span></a></li><li><a class="level is-mobile" href="#索引别名"><span class="level-left"><span class="level-item">5.6</span><span class="level-item">索引别名</span></span></a></li></ul></li><li><a class="level is-mobile" href="#文档的基本操作"><span class="level-left"><span class="level-item">6</span><span class="level-item">文档的基本操作</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#新建文档"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">新建文档</span></span></a></li><li><a class="level is-mobile" href="#查询文档"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">查询文档</span></span></a></li><li><a class="level is-mobile" href="#更新文档"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">更新文档</span></span></a></li><li><a class="level is-mobile" href="#查询更新"><span class="level-left"><span class="level-item">6.4</span><span class="level-item">查询更新</span></span></a></li><li><a class="level is-mobile" href="#删除文档"><span class="level-left"><span class="level-item">6.5</span><span class="level-item">删除文档</span></span></a></li><li><a class="level is-mobile" href="#查询删除"><span class="level-left"><span class="level-item">6.6</span><span class="level-item">查询删除</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#批量操作"><span class="level-left"><span class="level-item">6.6.1</span><span class="level-item">批量操作</span></span></a></li></ul></li><li><a class="level is-mobile" href="#文档路由"><span class="level-left"><span class="level-item">6.7</span><span class="level-item">文档路由</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ES的版本控制"><span class="level-left"><span class="level-item">7</span><span class="level-item">ES的版本控制</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#版本控制"><span class="level-left"><span class="level-item">7.1.1</span><span class="level-item">版本控制</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#内部版本"><span class="level-left"><span class="level-item">7.1.1.1</span><span class="level-item">内部版本</span></span></a></li><li><a class="level is-mobile" href="#外部版本"><span class="level-left"><span class="level-item">7.1.1.2</span><span class="level-item">外部版本</span></span></a></li><li><a class="level is-mobile" href="#最新方案（Es6-7-之后）"><span class="level-left"><span class="level-item">7.1.1.3</span><span class="level-item">最新方案（Es6.7 之后）</span></span></a></li></ul></li></ul></ul></li><li><a class="level is-mobile" href="#倒排索引"><span class="level-left"><span class="level-item">8</span><span class="level-item">倒排索引</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#“正排索引”"><span class="level-left"><span class="level-item">8.1.1</span><span class="level-item">“正排索引”</span></span></a></li><li><a class="level is-mobile" href="#倒排索引-1"><span class="level-left"><span class="level-item">8.1.2</span><span class="level-item">倒排索引</span></span></a></li></ul></ul></li></ul></div></div><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">技术</span></span><span class="level-end"><span class="level-item tag">44</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T02:48:15.000Z">2021-08-03</time></p><p class="title"><a href="/2021/08/03/JavaSE-%E5%85%AD-%E6%B3%9B%E5%9E%8B%E3%80%81%E6%9E%9A%E4%B8%BE%E5%92%8C%E6%B3%A8%E8%A7%A3/">JavaSE(六)泛型、枚举和注解</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T00:46:15.000Z">2021-08-03</time></p><p class="title"><a href="/2021/08/03/JavaSE-%E4%BA%94-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/">JavaSE-五-异常处理</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-02T08:46:15.000Z">2021-08-02</time></p><p class="title"><a href="/2021/08/02/JavaSE-%E5%9B%9B-%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%86%85%E9%83%A8%E7%B1%BB/">JavaSE-四-接口与内部类</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-02T07:46:15.000Z">2021-08-02</time></p><p class="title"><a href="/2021/08/02/JavaSE-%E4%B8%89-%E7%B1%BB%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E7%BB%A7%E6%89%BF/">JavaSE(三)类的设计和继承</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-01T07:46:15.000Z">2021-08-01</time></p><p class="title"><a href="/2021/08/01/JavaSE-%E4%BA%8C-%E5%AF%B9%E8%B1%A1%E5%92%8C%E7%B1%BB/">JavaSE(二)对象和类</a></p><p class="categories"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></p></div></article></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="漫漫转码路" height="28"></a><p class="is-size-7"><span>&copy; 2021 binshow</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>